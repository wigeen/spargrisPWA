<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="Mina Pengar"/>
  <title>Mina Pengar üíú</title>
  <link rel="apple-touch-icon" href="icon-192.png"/>
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet"/>
  <style>
    :root{--bg:#F7F3FF;--card:#fff;--primary:#7C5CBF;--pl:#EDE8FA;--green:#27AE60;--gl:#E6F7EE;--coral:#FF6B6B;--cl:#FFE8E8;--gold:#F5A623;--gol:#FEF5E4;--teal:#1ABC9C;--tl:#E6F9F5;--orange:#E67E22;--ol:#FDF0E6;--pink:#E91E8C;--pkl:#FCE4F3;--text:#1A1A2E;--muted:#9A9AB0;--border:#EDE8F5;--shadow:0 4px 24px rgba(124,92,191,.08);--r:22px;--rs:14px;}
    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
    body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
    body::before{content:'';position:fixed;top:-140px;right:-100px;width:380px;height:380px;background:radial-gradient(circle,#D9CCFF 0%,transparent 70%);border-radius:50%;z-index:0;pointer-events:none;}
    body::after{content:'';position:fixed;bottom:-120px;left:-80px;width:320px;height:320px;background:radial-gradient(circle,#C8F5E9 0%,transparent 70%);border-radius:50%;z-index:0;pointer-events:none;}
    #cc{position:fixed;inset:0;z-index:999;pointer-events:none;}

    /* TABS */
    .tab-bar{position:fixed;bottom:0;left:0;right:0;z-index:50;background:rgba(255,255,255,.95);backdrop-filter:blur(16px);border-top:1.5px solid var(--border);display:flex;max-width:420px;margin:0 auto;padding-bottom:env(safe-area-inset-bottom,0px);}
    .tb{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:9px 4px 7px;background:none;border:none;cursor:pointer;font-family:'Nunito',sans-serif;font-size:9px;font-weight:800;color:var(--muted);transition:color .18s;}
    .tb .ti{font-size:20px;transition:transform .18s;}
    .tb.active{color:var(--primary);}
    .tb.active .ti{transform:scale(1.15);}
    .page{display:none;position:relative;z-index:1;max-width:420px;margin:0 auto;padding:0 16px 100px;}
    .page.active{display:block;}

    /* TOP BAR */
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:54px 0 0;}
    .topbar-title{font-family:'DM Serif Display',serif;font-size:30px;letter-spacing:-.5px;}
    .topbar-sub{font-size:12px;color:var(--muted);font-weight:600;margin-top:2px;}
    .gear-btn{width:42px;height:42px;border-radius:50%;background:var(--card);border:1.5px solid var(--border);box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;transition:transform .15s,background .15s;flex-shrink:0;}
    .gear-btn:active{transform:scale(.92);background:var(--pl);}
    .page-header{padding:52px 0 20px;animation:fD .5s ease both;}
    .page-header h1{font-family:'DM Serif Display',serif;font-size:28px;letter-spacing:-.5px;}
    .page-header p{font-size:13px;color:var(--muted);margin-top:4px;font-weight:600;}

    /* HERO CARDS */
    .c-total{background:linear-gradient(135deg,#7C5CBF,#5B3FA0);border-radius:var(--r);padding:26px 24px 22px;margin-bottom:14px;box-shadow:0 8px 32px rgba(124,92,191,.28);position:relative;overflow:hidden;animation:fU .4s ease both;}
    .c-total::before{content:'';position:absolute;top:-40px;right:-40px;width:160px;height:160px;background:rgba(255,255,255,.08);border-radius:50%;}
    .tl{font-size:11px;font-weight:800;letter-spacing:1.4px;text-transform:uppercase;color:rgba(255,255,255,.65);margin-bottom:8px;}
    .ta{font-family:'DM Serif Display',serif;font-size:52px;color:#fff;line-height:1;letter-spacing:-1.5px;}
    .ta .cur{font-size:26px;vertical-align:super;margin-right:3px;}
    .ts{font-size:12px;color:rgba(255,255,255,.55);font-weight:600;margin-top:8px;}
    .c-peng{background:linear-gradient(135deg,#E91E8C,#B5106A);border-radius:var(--r);padding:22px 22px 18px;margin-bottom:14px;box-shadow:0 8px 32px rgba(233,30,140,.25);position:relative;overflow:hidden;animation:fU .45s ease both;}
    .c-peng::before{content:'';position:absolute;top:-40px;right:-40px;width:150px;height:150px;background:rgba(255,255,255,.08);border-radius:50%;}
    .pl2{font-size:11px;font-weight:800;letter-spacing:1.4px;text-transform:uppercase;color:rgba(255,255,255,.65);margin-bottom:6px;}
    .pa{font-family:'DM Serif Display',serif;font-size:42px;color:#fff;line-height:1;letter-spacing:-1px;}
    .pa .cur{font-size:22px;vertical-align:super;margin-right:2px;}
    .pe{font-size:13px;color:rgba(255,255,255,.8);font-weight:800;margin-top:4px;}
    .ps{font-size:12px;color:rgba(255,255,255,.6);font-weight:600;margin-top:2px;}
    .ppt{margin-top:14px;}
    .pptrack{background:rgba(255,255,255,.2);border-radius:999px;height:10px;overflow:hidden;margin-bottom:6px;}
    .ppfill{height:100%;background:#fff;border-radius:999px;transition:width .7s cubic-bezier(.4,0,.2,1);min-width:5px;}
    .pplbls{display:flex;justify-content:space-between;font-size:11px;font-weight:800;color:rgba(255,255,255,.7);}
    .pppct{color:#fff;}
    .send-wrap{margin-top:12px;display:flex;gap:8px;}
    .btn-send{flex:1;padding:13px 8px;border:none;border-radius:var(--rs);font-family:'Nunito',sans-serif;font-size:13px;font-weight:900;cursor:pointer;transition:transform .14s;color:#fff;}
    .btn-send:active{transform:scale(.95);}
    .bs-sms{background:rgba(255,255,255,.25);}
    .bs-wa{background:#25D366;}
    .btn-reset{width:100%;padding:12px;border:2px solid rgba(255,255,255,.3);border-radius:var(--rs);background:transparent;color:rgba(255,255,255,.8);font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .18s;margin-top:8px;}
    .btn-reset:active{background:rgba(255,255,255,.15);}

    /* SMALL CARDS */
    .g2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;animation:fU .45s ease .07s both;}
    .card{background:var(--card);border-radius:var(--r);padding:18px 18px 16px;box-shadow:var(--shadow);border:1.5px solid var(--border);}
    .clbl{font-size:11px;font-weight:800;letter-spacing:1.2px;text-transform:uppercase;margin-bottom:6px;}
    .camt{font-family:'DM Serif Display',serif;font-size:28px;line-height:1.1;letter-spacing:-.5px;}
    .camt .cur{font-size:15px;vertical-align:super;margin-right:2px;}
    .csub{font-size:11px;font-weight:600;margin-top:4px;color:var(--muted);}
    .card-s .clbl,.card-s .camt{color:#6A4FCF;}
    .card-p .clbl,.card-p .camt{color:var(--teal);}

    /* GOAL */
    .c-goal{background:var(--card);border-radius:var(--r);padding:20px 20px 18px;box-shadow:var(--shadow);border:1.5px solid var(--border);margin-bottom:14px;animation:fU .45s ease .1s both;}
    .gh{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
    .gnl{font-size:11px;font-weight:800;letter-spacing:1.2px;text-transform:uppercase;color:var(--gold);margin-bottom:3px;}
    .gn{font-size:15px;font-weight:800;}
    .garow{display:flex;align-items:baseline;gap:6px;margin-bottom:12px;}
    .gc{font-family:'DM Serif Display',serif;font-size:26px;color:var(--gold);}
    .gsep{color:var(--muted);font-weight:700;font-size:14px;}
    .gtar2{font-size:16px;color:var(--muted);font-weight:700;}
    .ptrack{border-radius:999px;height:12px;overflow:hidden;margin-bottom:8px;}
    .ptrack.gold{background:var(--gol);}
    .pfill{height:100%;border-radius:999px;transition:width .7s cubic-bezier(.4,0,.2,1);min-width:5px;}
    .pfill.gold{background:linear-gradient(90deg,#F5A623,#FF8C42);}
    .plbls{display:flex;justify-content:space-between;font-size:11px;font-weight:700;}
    .pleft{color:var(--muted);}
    .ppct2{font-weight:900;font-size:12px;color:var(--gold);}
    .btn-ghost{background:none;border:2px solid var(--border);border-radius:10px;padding:5px 11px;font-family:'Nunito',sans-serif;font-size:11px;font-weight:800;color:var(--muted);cursor:pointer;transition:all .18s;}
    .btn-ghost:active{transform:scale(.95);background:var(--border);}

    /* ACTIONS */
    .acts{margin-bottom:16px;animation:fU .45s ease .15s both;}
    .stitle{font-size:11px;font-weight:800;letter-spacing:1.2px;text-transform:uppercase;color:var(--muted);margin-bottom:10px;padding:0 2px;}
    .agrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .ba{display:flex;flex-direction:column;align-items:center;gap:7px;padding:18px 10px 16px;border-radius:var(--r);border:1.5px solid transparent;font-family:'Nunito',sans-serif;font-weight:800;font-size:12px;cursor:pointer;transition:transform .14s,box-shadow .14s;box-shadow:var(--shadow);text-align:center;line-height:1.2;}
    .ba:active{transform:scale(.94);box-shadow:none;}
    .ba .ae{font-size:28px;}
    .ba-in{background:var(--gl);color:#1A8A49;border-color:#C0EDD4;}
    .ba-ear{background:var(--pl);color:#5B3FA0;border-color:#D4C8F5;}
    .ba-sp{background:var(--cl);color:#C94040;border-color:#FFCACA;}
    .ba-fr{background:var(--tl);color:#0E8A72;border-color:#A8EAD9;}

    /* RECENT HISTORY (home) */
    .recent-section{animation:fU .45s ease .2s both;}
    .recent-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
    .see-all{font-size:11px;font-weight:800;color:var(--primary);background:none;border:none;cursor:pointer;font-family:'Nunito',sans-serif;padding:0;}
    .hlist{display:flex;flex-direction:column;gap:8px;}
    .hi{background:var(--card);border-radius:var(--rs);padding:13px 15px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 8px rgba(124,92,191,.06);border:1.5px solid var(--border);}
    .hi.clickable{cursor:pointer;padding-bottom:20px;position:relative;}
    .hi.clickable:active{transform:scale(.98);}
    .hico{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;}
    .hg{background:var(--gl);}.hp{background:var(--pl);}.hc{background:var(--cl);}.ht{background:var(--tl);}.ho{background:var(--ol);}
    .htxt{flex:1;min-width:0;}
    .hdesc{font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .hdate{font-size:11px;color:var(--muted);margin-top:1px;font-weight:600;}
    .hamt{font-size:14px;font-weight:900;flex-shrink:0;}
    .ag{color:var(--green);}.ap{color:var(--primary);}.ac{color:var(--coral);}.at{color:var(--teal);}.ao{color:var(--orange);}
    .ehint{font-size:10px;color:var(--muted);position:absolute;right:15px;bottom:6px;font-weight:700;}
    .empty{text-align:center;padding:28px 20px;color:var(--muted);font-size:14px;font-weight:600;line-height:1.6;}
    .empty .ee{font-size:36px;display:block;margin-bottom:8px;}

    /* CHORES */
    .cc{background:var(--card);border-radius:var(--rs);padding:14px 16px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 8px rgba(124,92,191,.06);border:1.5px solid var(--border);margin-bottom:8px;transition:opacity .3s;}
    .cc.done{opacity:.5;}
    .ci{flex:1;min-width:0;}
    .cn{font-size:14px;font-weight:800;margin-bottom:2px;}
    .cpt{font-size:11px;color:var(--muted);font-weight:700;}
    .cet{font-size:11px;color:var(--pink);font-weight:800;}
    .cmtrack{background:var(--pkl);border-radius:999px;height:6px;margin-top:6px;overflow:hidden;}
    .cmfill{height:100%;background:linear-gradient(90deg,#E91E8C,#FF6B9D);border-radius:999px;transition:width .4s ease;}
    .cbtn{width:40px;height:40px;border-radius:50%;border:none;flex-shrink:0;font-size:18px;cursor:pointer;transition:transform .15s;display:flex;align-items:center;justify-content:center;}
    .cbtn.nd{background:var(--pkl);color:var(--pink);}
    .cbtn.nd:active{transform:scale(.88);}
    .cbtn.ad{background:var(--gl);color:var(--green);}
    .mgbtn{width:100%;padding:14px;border-radius:var(--rs);border:2px dashed var(--border);background:none;font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;color:var(--muted);cursor:pointer;margin-top:4px;}
    .mgbtn:active{background:var(--card);}

    /* OVERLAY + SHEETS */
    .overlay{position:fixed;inset:0;background:rgba(26,26,46,.4);backdrop-filter:blur(5px);z-index:100;opacity:0;pointer-events:none;transition:opacity .25s;}
    .overlay.visible{opacity:1;pointer-events:all;}
    .sheet{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-radius:28px 28px 0 0;padding:20px 22px 44px;transform:translateY(100%);transition:transform .32s cubic-bezier(.4,0,.2,1);z-index:101;max-width:420px;margin:0 auto;}
    .sheet.visible{transform:translateY(0);}
    .sh{width:40px;height:5px;background:var(--border);border-radius:99px;margin:0 auto 20px;}
    .sheet h2{font-family:'DM Serif Display',serif;font-size:24px;margin-bottom:4px;}
    .ssub{font-size:13px;color:var(--muted);font-weight:600;margin-bottom:20px;line-height:1.5;}
    .atog{display:flex;gap:8px;margin-bottom:12px;}
    .abtn{flex:1;padding:11px;border-radius:var(--rs);border:2px solid var(--border);background:var(--bg);font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;cursor:pointer;transition:all .15s;color:var(--muted);}
    .abtn.ap2{background:var(--gl);border-color:var(--green);color:var(--green);}
    .abtn.am{background:var(--cl);border-color:var(--coral);color:var(--coral);}
    .aftog{display:flex;gap:8px;margin-bottom:14px;}
    .afbtn{flex:1;padding:9px 4px;border-radius:var(--rs);border:2px solid var(--border);background:var(--bg);font-family:'Nunito',sans-serif;font-size:11px;font-weight:800;cursor:pointer;transition:all .15s;color:var(--muted);text-align:center;line-height:1.4;}
    .afbtn.active{background:var(--pl);border-color:var(--primary);color:var(--primary);}
    .iwrap{position:relative;margin-bottom:12px;}
    .ipfx{position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:22px;font-weight:900;color:var(--muted);pointer-events:none;font-family:'DM Serif Display',serif;}
    .ainp{width:100%;background:var(--bg);border:2px solid var(--border);border-radius:var(--rs);padding:15px 16px 15px 36px;font-family:'DM Serif Display',serif;font-size:34px;color:var(--text);outline:none;transition:border-color .18s;-moz-appearance:textfield;}
    .ainp::-webkit-outer-spin-button,.ainp::-webkit-inner-spin-button{-webkit-appearance:none;}
    .ainp:focus{border-color:var(--primary);}
    .ninp{width:100%;background:var(--bg);border:2px solid var(--border);border-radius:var(--rs);padding:13px 16px;font-family:'Nunito',sans-serif;font-size:15px;font-weight:600;color:var(--text);outline:none;margin-bottom:14px;transition:border-color .18s;}
    .ninp:focus{border-color:var(--primary);}
    .ninp::placeholder{color:var(--muted);}
    .nninp{width:100%;background:var(--bg);border:2px solid var(--border);border-radius:var(--rs);padding:13px 16px;font-family:'Nunito',sans-serif;font-size:20px;font-weight:800;color:var(--text);outline:none;margin-bottom:14px;-moz-appearance:textfield;}
    .nninp::-webkit-outer-spin-button,.nninp::-webkit-inner-spin-button{-webkit-appearance:none;}
    .bc{width:100%;padding:17px;border:none;border-radius:var(--rs);font-family:'Nunito',sans-serif;font-size:16px;font-weight:900;cursor:pointer;transition:transform .14s,box-shadow .14s;box-shadow:var(--shadow);}
    .bc:active{transform:scale(.97);box-shadow:none;}
    .bg{background:var(--green);color:#fff;}.bgo{background:var(--gold);color:#fff;}.bco{background:var(--coral);color:#fff;}.bt{background:var(--teal);color:#fff;}.bp{background:var(--primary);color:#fff;}.bo{background:var(--orange);color:#fff;}.bpk{background:var(--pink);color:#fff;}
    .rowbtns{display:flex;gap:10px;}
    .bdel{flex:0 0 auto;padding:17px 18px;border:none;border-radius:var(--rs);background:var(--cl);color:var(--coral);font-size:20px;cursor:pointer;transition:transform .14s;}
    .bdel:active{transform:scale(.95);}
    .mci{background:var(--bg);border-radius:var(--rs);padding:12px 14px;display:flex;align-items:center;gap:10px;margin-bottom:8px;border:1.5px solid var(--border);}
    .mci span{flex:1;font-size:13px;font-weight:700;}
    .mci small{font-size:11px;color:var(--muted);font-weight:600;}
    .brc{background:none;border:none;font-size:18px;cursor:pointer;padding:2px 4px;color:var(--coral);}

    /* SETTINGS SHEET */
    .scard{background:var(--bg);border-radius:var(--r);overflow:hidden;border:1.5px solid var(--border);margin-bottom:16px;}
    .srow{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border);}
    .srow:last-child{border-bottom:none;}
    .sico{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;}
    .si-pu{background:var(--pl);}.si-gr{background:var(--gl);}.si-bl{background:#E8F2FC;}.si-go{background:var(--gol);}.si-co{background:var(--cl);}.si-te{background:var(--tl);}.si-or{background:var(--ol);}
    .stxt{flex:1;min-width:0;}
    .slbl{font-size:13px;font-weight:800;}
    .sdesc{font-size:11px;color:var(--muted);font-weight:600;margin-top:1px;}
    .sact{background:none;border:2px solid var(--border);border-radius:10px;padding:5px 12px;font-family:'Nunito',sans-serif;font-size:12px;font-weight:800;color:var(--primary);cursor:pointer;white-space:nowrap;transition:all .18s;flex-shrink:0;}
    .sact:active{background:var(--pl);}
    .sact.danger{color:var(--coral);border-color:var(--cl);}
    .sact.danger:active{background:var(--cl);}
    .togwrap{display:flex;gap:4px;}
    .togopt{padding:5px 9px;border-radius:8px;border:2px solid var(--border);background:var(--card);font-family:'Nunito',sans-serif;font-size:11px;font-weight:800;color:var(--muted);cursor:pointer;transition:all .15s;}
    .togopt.active{background:var(--pl);border-color:var(--primary);color:var(--primary);}
    .sheet-stitle{font-size:11px;font-weight:800;letter-spacing:1px;text-transform:uppercase;color:var(--muted);margin-bottom:8px;margin-top:4px;}

    /* INPUT SHEET (name/mom) */
    #inp-sheet{z-index:110;}
    /* CONFIRM SHEET */
    #conf-sheet{z-index:110;}
    .conf-icon{font-size:48px;text-align:center;display:block;margin-bottom:8px;}
    .conf-btns{display:flex;gap:10px;margin-top:6px;}
    .btn-cancel{flex:1;padding:16px;border:2px solid var(--border);border-radius:var(--rs);background:none;font-family:'Nunito',sans-serif;font-size:15px;font-weight:900;cursor:pointer;color:var(--muted);}

    /* UNDO + TOAST */
    .ubar{position:fixed;bottom:72px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--text);color:#fff;border-radius:999px;padding:13px 18px;display:flex;align-items:center;gap:14px;font-size:13px;font-weight:700;z-index:300;box-shadow:0 6px 24px rgba(0,0,0,.25);transition:transform .3s cubic-bezier(.4,0,.2,1),opacity .3s;opacity:0;pointer-events:none;white-space:nowrap;}
    .ubar.visible{transform:translateX(-50%) translateY(0);opacity:1;pointer-events:all;}
    .ubtn{background:rgba(255,255,255,.2);border:none;color:#fff;font-family:'Nunito',sans-serif;font-size:13px;font-weight:900;padding:6px 14px;border-radius:999px;cursor:pointer;}
    .toast{position:fixed;top:58px;left:50%;transform:translateX(-50%) translateY(-16px);background:var(--text);color:#fff;border-radius:999px;padding:12px 22px;font-size:14px;font-weight:700;z-index:400;opacity:0;transition:opacity .2s,transform .2s;white-space:nowrap;pointer-events:none;box-shadow:0 4px 20px rgba(0,0,0,.2);}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

    #es{z-index:102;}#gs{z-index:103;}#ms{z-index:103;}#set-sheet{z-index:104;}
    @keyframes fU{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    @keyframes fD{from{opacity:0;transform:translateY(-14px);}to{opacity:1;transform:translateY(0);}}
  </style>
</head>
<body>
<canvas id="cc"></canvas>

<!-- ‚ïê‚ïê‚ïê PENGAR ‚ïê‚ïê‚ïê -->
<div class="page active" id="page-pengar">
  <div style="padding:0 0 18px;">
    <div class="topbar">
      <div>
        <div class="topbar-title"><span style="filter:sepia(1) saturate(4) hue-rotate(5deg)">ü™ô</span> Mina Pengar</div>
        <div class="topbar-sub" id="greeting">Hej! Kolla din ekonomi üëã</div>
      </div>
      <button class="gear-btn" onclick="openSettings()">‚öôÔ∏è</button>
    </div>
  </div>
  <div class="c-total">
    <div class="tl">Totalt saldo</div>
    <div class="ta"><span class="cur">kr</span><span id="tot">0</span></div>
    <div class="ts" id="tsub">S√§tt in pengar f√∂r att b√∂rja!</div>
  </div>
  <div class="g2">
    <div class="card card-s"><div class="clbl">üíé Sparande</div><div class="camt"><span class="cur">kr</span><span id="ear">0</span></div><div class="csub">Mot ditt m√•l</div></div>
    <div class="card card-p"><div class="clbl">üí∞ Fickpengar</div><div class="camt"><span class="cur">kr</span><span id="fr">0</span></div><div class="csub">Att handla f√∂r</div></div>
  </div>
  <div class="c-goal">
    <div class="gh"><div><div class="gnl">üéØ Sparm√•l</div><div class="gn" id="gname">S√§tt ett m√•l!</div></div><button class="btn-ghost" onclick="openGoal()">√Ñndra m√•l</button></div>
    <div class="garow"><span class="gc" id="gcur">0</span><span class="gsep">av</span><span class="gtar2" id="gtar">0 kr</span></div>
    <div class="ptrack gold"><div class="pfill gold" id="pfill" style="width:0%"></div></div>
    <div class="plbls"><span class="pleft" id="gleft">S√§tt ett m√•l f√∂r att b√∂rja!</span><span class="ppct2" id="gpct">0%</span></div>
  </div>
  <div class="acts">
    <div class="stitle">Vad vill du g√∂ra?</div>
    <div class="agrid">
      <button class="ba ba-in"  onclick="openSheet('in')"><span class="ae">üíµ</span>S√§tt in pengar</button>
      <button class="ba ba-ear" onclick="openSheet('ear')"><span class="ae">üíé</span>Flytta till sparande</button>
      <button class="ba ba-sp"  onclick="openSheet('sp')"><span class="ae">üõí</span>Jag handlade</button>
      <button class="ba ba-fr"  onclick="openSheet('fr')"><span class="ae">‚Ü©Ô∏è</span>Flytta fr√•n sparande</button>
    </div>
  </div>
  <div class="recent-section">
    <div class="recent-header">
      <div class="stitle" style="margin-bottom:0;">Senaste transaktionerna</div>
      <button class="see-all" onclick="sw('hist')">Se alla ‚Üí</button>
    </div>
    <div style="height:10px;"></div>
    <div class="hlist" id="recent-list"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SYSSLOR ‚ïê‚ïê‚ïê -->
<div class="page" id="page-sysslor">
  <div class="page-header"><h1>üßπ Mina Sysslor</h1><p id="cgreet">G√∂r klart dina sysslor f√∂r att f√• din m√•nadspeng!</p></div>
  <div class="c-peng">
    <div class="pl2">üí∞ M√•nadspeng / Veckopeng</div>
    <div class="pa"><span class="cur">kr</span><span id="pamt">0</span></div>
    <div class="pe" id="pearned" style="display:none;"></div>
    <div class="ps" id="psub">S√§tt ett belopp och l√§gg till sysslor!</div>
    <div class="ppt">
      <div class="pptrack"><div class="ppfill" id="ppfill" style="width:0%"></div></div>
      <div class="pplbls"><span id="ppleft">0 av 0 sysslor klara</span><span class="pppct" id="pppct">0%</span></div>
    </div>
    <div id="sendwrap"></div>
    <button class="btn-reset" onclick="resetChores()">üîÑ √Öterst√§ll sysslor (ny period)</button>
  </div>
  <div class="stitle" style="margin-bottom:10px;">Sysslor att g√∂ra</div>
  <div id="clist"></div>
  <button class="mgbtn" onclick="openManage()">‚öôÔ∏è Hantera sysslor & pengar</button>
</div>

<!-- ‚ïê‚ïê‚ïê HISTORIK ‚ïê‚ïê‚ïê -->
<div class="page" id="page-hist">
  <div class="page-header"><h1>üìã Historik</h1><p>Tryck p√• en transaktion f√∂r att redigera</p></div>
  <div class="hlist" id="full-hlist"></div>
</div>

<!-- TAB BAR -->
<div class="tab-bar">
  <button class="tb active" id="tab-pengar"  onclick="sw('pengar')"><span class="ti" style="filter:sepia(1) saturate(4) hue-rotate(5deg)">ü™ô</span>Pengar</button>
  <button class="tb"        id="tab-sysslor" onclick="sw('sysslor')"><span class="ti">üßπ</span>Sysslor</button>
  <button class="tb"        id="tab-hist"    onclick="sw('hist')"><span class="ti">üìã</span>Historik</button>
</div>

<div class="overlay" id="ov" onclick="closeAll()"></div>

<!-- MAIN ACTION SHEET -->
<div class="sheet" id="msh">
  <div class="sh"></div><h2 id="shtit">‚Äì</h2><div class="ssub" id="shdesc">‚Äì</div>
  <div class="atog" id="atog" style="display:none">
    <button class="abtn ap2" id="tp" onclick="setDir(1)">‚ûï L√§gga till</button>
    <button class="abtn"     id="tm" onclick="setDir(-1)">‚ûñ Dra av</button>
  </div>
  <div class="aftog" id="aftog" style="display:none">
    <button class="afbtn active" id="af-tot" onclick="setAff('tot')">üíú Totalt<br>saldo</button>
    <button class="afbtn"        id="af-ear" onclick="setAff('ear')">üíé Spa-<br>rande</button>
    <button class="afbtn"        id="af-fr"  onclick="setAff('fr')">üí∞ Fick-<br>pengar</button>
  </div>
  <div class="iwrap"><span class="ipfx">kr</span><input class="ainp" type="number" id="samt" placeholder="0" inputmode="decimal"/></div>
  <input class="ninp" type="text" id="snote" placeholder="Anteckning (valfritt)"/>
  <button class="bc" id="sbtn" onclick="confirm2()">Bekr√§fta</button>
</div>

<!-- EDIT HISTORY SHEET -->
<div class="sheet" id="es">
  <div class="sh"></div><h2 id="etit">Redigera</h2>
  <div class="ssub">√Ñndra beloppet eller anteckningen. Vill du korrigera saldot? Anv√§nd ‚öñÔ∏è Justera i Inst√§llningar.</div>
  <div class="iwrap"><span class="ipfx">kr</span><input class="ainp" type="number" id="eamt" placeholder="0" inputmode="decimal"/></div>
  <input class="ninp" type="text" id="enote" placeholder="Anteckning"/>
  <div class="rowbtns">
    <button class="bdel" onclick="delEntry()">üóë</button>
    <button class="bc bp" style="flex:1" onclick="saveEdit()">Spara √§ndringar</button>
  </div>
</div>

<!-- GOAL SHEET -->
<div class="sheet" id="gs">
  <div class="sh"></div><h2>üéØ S√§tt ett sparm√•l</h2><div class="ssub">Vad sparar du till?</div>
  <input class="ninp" type="text" id="ginp" placeholder="t.ex. H√∂rlurar, Resa, Spelkonsol‚Ä¶"/>
  <div class="iwrap"><span class="ipfx">kr</span><input class="ainp" type="number" id="gamt" placeholder="0" inputmode="decimal"/></div>
  <div style="height:14px"></div>
  <button class="bc bgo" onclick="saveGoal()">Spara m√•l üéØ</button>
</div>

<!-- MANAGE CHORES SHEET -->
<div class="sheet" id="ms">
  <div class="sh"></div><h2>‚öôÔ∏è Hantera sysslor & pengar</h2>
  <div class="ssub">L√§gg till sysslor och s√§tt belopp f√∂r m√•nadspengen.</div>
  <div class="sheet-stitle">üí∞ M√•nadspeng n√§r allt √§r klart</div>
  <div class="iwrap" style="margin-bottom:14px"><span class="ipfx">kr</span><input class="ainp" type="number" id="pinp" placeholder="0" inputmode="decimal" style="font-size:28px"/></div>
  <div class="sheet-stitle">‚ûï Ny syssla</div>
  <input class="ninp" type="text" id="cname" placeholder="t.ex. St√§da rummet, Diska‚Ä¶" style="margin-bottom:8px"/>
  <div style="display:flex;gap:8px;margin-bottom:14px">
    <div style="flex:1"><div style="font-size:11px;font-weight:700;color:var(--muted);margin-bottom:4px">Antal g√•nger</div>
    <input class="nninp" type="number" id="ccnt" placeholder="1" inputmode="numeric" min="1"/></div>
  </div>
  <button class="bc bpk" onclick="addChore()" style="margin-bottom:16px">L√§gg till syssla ‚ú®</button>
  <div class="sheet-stitle">üìã Befintliga sysslor</div>
  <div id="mclist"></div>
  <div style="height:10px"></div>
  <button class="bc bp" onclick="saveManage()">Spara allt ‚úÖ</button>
</div>

<!-- SETTINGS SHEET -->
<div class="sheet" id="set-sheet" style="max-height:85vh;overflow-y:scroll;-webkit-overflow-scrolling:touch;">
  <div style="position:sticky;top:0;background:var(--card);z-index:10;padding-bottom:10px;display:flex;justify-content:space-between;align-items:center;">
    <div style="width:40px;height:5px;background:var(--border);border-radius:99px;flex:1;max-width:40px;"></div>
    <button onclick="closeAll()" style="width:36px;height:36px;border-radius:50%;border:none;background:var(--border);color:var(--muted);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:900;flex-shrink:0;transition:background .15s;">‚úï</button>
  </div>
  <h2>‚öôÔ∏è Inst√§llningar</h2>
  <div class="ssub" style="margin-bottom:14px;">Anpassa appen efter dig</div>

  <div class="sheet-stitle">üë§ Profil</div>
  <div class="scard">
    <div class="srow">
      <div class="sico si-pu">üë§</div>
      <div class="stxt"><div class="slbl">Ditt namn</div><div class="sdesc" id="dname">Inte inst√§llt</div></div>
      <button class="sact" onclick="openInpSheet('name')">√Ñndra</button>
    </div>
    <div class="srow">
      <div class="sico si-te">üì±</div>
      <div class="stxt"><div class="slbl">Mammans nummer</div><div class="sdesc" id="dmom">Inte inst√§llt</div></div>
      <button class="sact" onclick="openInpSheet('mom')">√Ñndra</button>
    </div>
  </div>

  <div class="sheet-stitle">üí¨ Meddelanden</div>
  <div class="scard">
    <div class="srow">
      <div class="sico si-gr">üí¨</div>
      <div class="stxt"><div class="slbl">Meddelandeapp</div><div class="sdesc">Visas n√§r alla sysslor √§r klara</div></div>
      <div class="togwrap">
        <button class="togopt active" id="tog-both" onclick="setApp('both')">B√•da</button>
        <button class="togopt" id="tog-sms" onclick="setApp('sms')">SMS</button>
        <button class="togopt" id="tog-wa"  onclick="setApp('wa')">WA</button>
      </div>
    </div>
  </div>

  <div class="sheet-stitle">‚öñÔ∏è Kalibrera saldo</div>
  <div class="scard">
    <div class="srow">
      <div class="sico si-or">‚öñÔ∏è</div>
      <div class="stxt"><div class="slbl">Justera saldo</div><div class="sdesc">Korrigera om n√•got blivit fel</div></div>
      <button class="sact" onclick="closeAll();openSheet('adj')">√ñppna</button>
    </div>
  </div>

  <div class="sheet-stitle">üíæ Backup</div>
  <div class="scard">
    <div class="srow">
      <div class="sico si-bl">üì§</div>
      <div class="stxt"><div class="slbl">Exportera backup</div><div class="sdesc">Spara all data som en fil</div></div>
      <button class="sact" onclick="exportB()">Exportera</button>
    </div>
    <div class="srow">
      <div class="sico si-go">üì•</div>
      <div class="stxt"><div class="slbl">Importera backup</div><div class="sdesc">Ladda in sparad data</div></div>
      <button class="sact" onclick="document.getElementById('imp').click()">Importera</button>
      <input type="file" id="imp" accept=".json" style="display:none" onchange="importB(event)"/>
    </div>
  </div>

  <div class="sheet-stitle">‚ö†Ô∏è Farlig zon</div>
  <div class="scard">
    <div class="srow">
      <div class="sico si-co">üóëÔ∏è</div>
      <div class="stxt"><div class="slbl">√Öterst√§ll all data</div><div class="sdesc">Tar bort allt ‚Äì b√∂rja om</div></div>
      <button class="sact danger" onclick="openResetConfirm()">√Öterst√§ll</button>
    </div>
  </div>

  <div class="sheet-stitle">‚ùì Hj√§lp & f√∂rklaring</div>
  <div class="scard" id="help-card">
    <div class="srow" onclick="toggleHelp('h-pengar')" style="cursor:pointer;">
      <div class="sico si-pu">ü™ô</div>
      <div class="stxt"><div class="slbl">Mina Pengar ‚Äì fliken</div><div class="sdesc">Tryck f√∂r att l√§sa mer</div></div>
      <span style="color:var(--muted);font-size:16px;" id="arr-pengar">‚Ä∫</span>
    </div>
    <div id="h-pengar" style="display:none;padding:4px 16px 14px;font-size:13px;font-weight:600;color:var(--muted);line-height:1.7;border-bottom:1px solid var(--border);">
      <b style="color:var(--text);">Totalt saldo</b> √§r summan av alla dina pengar ‚Äì b√•de sparande och fickpengar tillsammans.<br><br>
      <b style="color:var(--text);">üíé Sparande</b> √§r pengar du valt att l√§gga undan mot ett m√•l, t.ex. ett par h√∂rlurar eller en resa. De r√§knas fortfarande som dina pengar men √§r "reserverade" ‚Äì du kan inte handla f√∂r dem direkt.<br><br>
      <b style="color:var(--text);">üí∞ Fickpengar</b> √§r det du har kvar att handla och anv√§nda fritt. Utr√§knas automatiskt: Totalt minus Sparande.<br><br>
      <b style="color:var(--text);">üéØ Sparm√•l</b> visar hur l√•ngt du kommit mot det du sparar till. Tryck p√• "√Ñndra m√•l" f√∂r att v√§lja vad du sparar till och hur mycket det kostar.
    </div>
    <div class="srow" onclick="toggleHelp('h-actions')" style="cursor:pointer;">
      <div class="sico si-gr">üîò</div>
      <div class="stxt"><div class="slbl">Knapparna p√• hemsk√§rmen</div><div class="sdesc">Tryck f√∂r att l√§sa mer</div></div>
      <span style="color:var(--muted);font-size:16px;" id="arr-actions">‚Ä∫</span>
    </div>
    <div id="h-actions" style="display:none;padding:4px 16px 14px;font-size:13px;font-weight:600;color:var(--muted);line-height:1.7;border-bottom:1px solid var(--border);">
      <b style="color:var(--text);">üíµ S√§tt in pengar</b> ‚Äì fick du veckopeng, present eller tj√§nade du egna pengar? Tryck h√§r och ange beloppet s√• l√§ggs det till ditt totala saldo.<br><br>
      <b style="color:var(--text);">üíé Flytta till sparande</b> ‚Äì vill du spara undan en del? Ange hur mycket som ska flyttas fr√•n fickpengar till sparandet. Pengarna finns kvar men r√§knas mot ditt m√•l.<br><br>
      <b style="color:var(--text);">üõí Jag handlade</b> ‚Äì k√∂pte du n√•got? Ange vad det kostade och en kort anteckning. Beloppet dras fr√•n dina fickpengar.<br><br>
      <b style="color:var(--text);">‚Ü©Ô∏è Flytta fr√•n sparande</b> ‚Äì √•ngrat dig eller beh√∂ver anv√§nda sparade pengar? Flytta tillbaka dem till fickpengar h√§r.<br><br>
      <b style="color:var(--text);">√Öngra-knappen</b> dyker upp i 5 sekunder efter varje √•tg√§rd om du r√•kat trycka fel.
    </div>
    <div class="srow" onclick="toggleHelp('h-hist')" style="cursor:pointer;">
      <div class="sico si-bl">üìã</div>
      <div class="stxt"><div class="slbl">Historik</div><div class="sdesc">Tryck f√∂r att l√§sa mer</div></div>
      <span style="color:var(--muted);font-size:16px;" id="arr-hist">‚Ä∫</span>
    </div>
    <div id="h-hist" style="display:none;padding:4px 16px 14px;font-size:13px;font-weight:600;color:var(--muted);line-height:1.7;border-bottom:1px solid var(--border);">
      <b style="color:var(--text);">Senaste transaktioner</b> p√• hemsk√§rmen visar dina 5 senaste h√§ndelser s√• du snabbt ser vad som h√§nt.<br><br>
      <b style="color:var(--text);">üìã Historik-fliken</b> visar alla transaktioner du n√•gonsin gjort. Tryck p√• en h√§ndelse f√∂r att redigera beloppet eller anteckningen ‚Äì eller ta bort den med üóë om du lade in n√•got fel.<br><br>
      <b style="color:var(--text);">OBS!</b> Om du tar bort eller redigerar en transaktion i historiken √§ndras inte ditt saldo automatiskt. Anv√§nd ‚öñÔ∏è Justera saldo (i inst√§llningar) f√∂r att r√§tta till saldot om n√•got blivit fel.
    </div>
    <div class="srow" onclick="toggleHelp('h-sysslor')" style="cursor:pointer;">
      <div class="sico si-or">üßπ</div>
      <div class="stxt"><div class="slbl">Sysslor</div><div class="sdesc">Tryck f√∂r att l√§sa mer</div></div>
      <span style="color:var(--muted);font-size:16px;" id="arr-sysslor">‚Ä∫</span>
    </div>
    <div id="h-sysslor" style="display:none;padding:4px 16px 14px;font-size:13px;font-weight:600;color:var(--muted);line-height:1.7;border-bottom:1px solid var(--border);">
      <b style="color:var(--text);">Kom ig√•ng:</b> Tryck p√• "‚öôÔ∏è Hantera sysslor & pengar" f√∂r att l√§gga till sysslor (t.ex. St√§da rummet 4 g√•nger) och best√§mma hur mycket du f√•r n√§r allt √§r klart.<br><br>
      <b style="color:var(--text);">Bocka av sysslor</b> ‚Äì tryck ‚úîÔ∏è varje g√•ng du gjort en syssla. Om du tryckt f√∂r m√•nga g√•nger, tryck igen f√∂r att √•ngra ett steg.<br><br>
      <b style="color:var(--text);">Progressbaren</b> visar hur l√•ngt du kommit. Under varje syssla ser du ocks√• hur mycket den √§r v√§rd i kronor.<br><br>
      <b style="color:var(--text);">üéâ Beg√§r min m√•nadspeng</b> ‚Äì dyker upp n√§r alla sysslor √§r klara. Skickar ett SMS eller WhatsApp-meddelande direkt till mamma med en beg√§ran om din peng!<br><br>
      <b style="color:var(--text);">üîÑ √Öterst√§ll sysslor</b> ‚Äì tryck i b√∂rjan av varje ny vecka eller m√•nad f√∂r att nollst√§lla alla sysslor och b√∂rja om.
    </div>
    <div class="srow" onclick="toggleHelp('h-backup')" style="cursor:pointer;">
      <div class="sico si-go">üíæ</div>
      <div class="stxt"><div class="slbl">Backup</div><div class="sdesc">Tryck f√∂r att l√§sa mer</div></div>
      <span style="color:var(--muted);font-size:16px;" id="arr-backup">‚Ä∫</span>
    </div>
    <div id="h-backup" style="display:none;padding:4px 16px 14px;font-size:13px;font-weight:600;color:var(--muted);line-height:1.7;">
      All din data sparas p√• din telefon. Om du rensar Safari eller byter telefon kan data f√∂rsvinna ‚Äì d√§rf√∂r finns backup!<br><br>
      <b style="color:var(--text);">üì§ Exportera backup</b> ‚Äì sparar ner allt (saldo, historik, sysslor, m√•l) som en fil p√• din telefon. G√∂r detta lite d√• och d√• s√• att du alltid har en kopia.<br><br>
      <b style="color:var(--text);">üì• Importera backup</b> ‚Äì har du bytt telefon eller r√•kat √•terst√§lla? Ladda in din sparade backup-fil s√• √§r allt tillbaka som det var.
    </div>
  </div>
  <div style="text-align:center;padding:6px 0 0;font-size:11px;color:var(--muted);font-weight:600;">Mina Pengar üíú ‚Äì byggd med k√§rlek</div>
</div>

<!-- INPUT SHEET (name / mom) -->
<div class="sheet" id="inp-sheet">
  <div class="sh"></div>
  <h2 id="inp-title">‚Äì</h2>
  <div class="ssub" id="inp-desc">‚Äì</div>
  <input class="ninp" type="text" id="inp-val" placeholder=""/>
  <button class="bc bp" onclick="saveInp()">Spara ‚úÖ</button>
</div>

<!-- CONFIRM RESET SHEET -->
<div class="sheet" id="conf-sheet">
  <div class="sh"></div>
  <span class="conf-icon">üóëÔ∏è</span>
  <h2>√Öterst√§ll all data?</h2>
  <div class="ssub">Detta tar bort ALL data ‚Äì saldo, historik, sysslor och sparm√•l. Det g√•r inte att √•ngra!</div>
  <div class="conf-btns">
    <button class="btn-cancel" onclick="closeAll()">Avbryt</button>
    <button class="bc bco" style="flex:1" onclick="resetAll()">Ja, √•terst√§ll allt</button>
  </div>
</div>

<div class="ubar" id="ub"><span id="umsg">Klar!</span><button class="ubtn" onclick="undo()">√Öngra</button></div>
<div class="toast" id="toast"></div>

<script>
let s=JSON.parse(localStorage.getItem('mpv7')||'null')||{total:0,ear:0,gamt:0,gname:'',pamt:0,chores:[],hist:[],uname:'',mom:'',app:'both'};
let snap=null,utmr=null,act='',dir=1,aff='tot',eidx=-1,inpKey='';
function save(){localStorage.setItem('mpv7',JSON.stringify(s));}
function free(){return Math.max(0,s.total-s.ear);}
function sw(t){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.tb').forEach(b=>b.classList.remove('active'));document.getElementById('page-'+t).classList.add('active');document.getElementById('tab-'+t).classList.add('active');}
function fmt(n){return Math.round(n).toLocaleString('sv-SE');}

function render(){
  document.getElementById('tot').textContent=fmt(s.total);
  document.getElementById('ear').textContent=fmt(s.ear);
  document.getElementById('fr').textContent=fmt(free());
  document.getElementById('tsub').textContent=s.total===0?'S√§tt in pengar f√∂r att b√∂rja!':fmt(s.ear)+' kr sparande ¬∑ '+fmt(free())+' kr fickpengar';
  document.getElementById('gname').textContent=s.gname||'S√§tt ett m√•l!';
  document.getElementById('gcur').textContent=fmt(s.ear);
  document.getElementById('gtar').textContent=fmt(s.gamt)+' kr';
  const gp=s.gamt>0?Math.min(100,(s.ear/s.gamt)*100):0;
  document.getElementById('pfill').style.width=gp+'%';
  document.getElementById('gpct').textContent=Math.round(gp)+'%';
  document.getElementById('gleft').textContent=gp>=100&&s.gamt>0?'üéâ M√•l uppn√•tt!':s.gamt>0?fmt(Math.max(0,s.gamt-s.ear))+' kr kvar':'S√§tt ett m√•l f√∂r att b√∂rja!';
  renderRecent();renderFullHist();renderChores();renderGreet();renderSett();
}

function renderGreet(){
  const h=new Date().getHours();
  const g=h<5?'God natt':h<10?'God morgon':h<18?'Hej':'God kv√§ll';
  const nm=s.uname?' '+s.uname:'';
  const gp=s.gamt>0?Math.min(100,(s.ear/s.gamt)*100):0;
  let st='kolla din ekonomi üëã';
  if(s.gamt>0&&gp>=100)st='du har n√•tt ditt sparm√•l! üéâ';
  else if(s.total>0&&s.gamt>0)st='du √§r '+Math.round(gp)+'% av v√§gen till m√•let!';
  else if(s.total>0)st='du har '+fmt(s.total)+' kr totalt';
  document.getElementById('greeting').textContent=g+nm+'! '+st.charAt(0).toUpperCase()+st.slice(1);
  const td=s.chores.reduce((a,c)=>a+c.done,0),tn=s.chores.reduce((a,c)=>a+c.tot,0);
  document.getElementById('cgreet').textContent=tn===0?'G√∂r klart dina sysslor f√∂r att f√• din m√•nadspeng!':td===tn?'üéâ Alla sysslor klara! Du har f√∂rtj√§nat din m√•nadspeng!':td+' av '+tn+' sysslor klara ‚Äì forts√§tt s√•!';
}

function renderSett(){
  document.getElementById('dname').textContent=s.uname||'Inte inst√§llt';
  document.getElementById('dmom').textContent=s.mom||'Inte inst√§llt';
  ['both','sms','wa'].forEach(k=>document.getElementById('tog-'+k).classList.toggle('active',s.app===k));
}

/* HISTORY */
const IM={in:{e:'üíµ',h:'hg',a:'ag',sg:'+'},ear:{e:'üíé',h:'hp',a:'ap',sg:'‚Üí'},sp:{e:'üõí',h:'hc',a:'ac',sg:'‚àí'},fr:{e:'‚Ü©Ô∏è',h:'ht',a:'at',sg:'‚Üê'},goal:{e:'üéØ',h:'hp',a:'ap',sg:''},adj:{e:'‚öñÔ∏è',h:'ho',a:'ao',sg:''}};
function addH(type,desc,amt){const now=new Date();s.hist.push({id:Date.now()+Math.random(),type,desc,amt,date:now.toLocaleDateString('sv-SE',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'})});if(s.hist.length>200)s.hist.shift();}

function histRow(item,idx,clickable){
  const m=IM[item.type]||IM['in'];
  const a=item.type==='adj'?(item.amt>=0?'+':'')+fmt(item.amt)+' kr':m.sg+fmt(Math.abs(item.amt))+' kr';
  const cls='hi'+(clickable?' clickable':'');
  const onclick=clickable?'onclick="openEdit('+idx+')"':'';
  const hint=clickable?'<span class="ehint">redigera</span>':'';
  return '<div class="'+cls+'" '+onclick+'><div class="hico '+m.h+'">'+m.e+'</div><div class="htxt"><div class="hdesc">'+item.desc+'</div><div class="hdate">'+item.date+'</div></div><div class="hamt '+m.a+'">'+a+'</div>'+hint+'</div>';
}

function renderRecent(){
  const l=document.getElementById('recent-list');
  if(!s.hist.length){l.innerHTML='<div class="empty"><span class="ee">üå±</span>Inga transaktioner √§n.<br>Tryck p√• "S√§tt in pengar" f√∂r att b√∂rja!</div>';return;}
  const recent=s.hist.slice(-5).reverse();
  l.innerHTML=recent.map(item=>histRow(item,-1,false)).join('');
}

function renderFullHist(){
  const l=document.getElementById('full-hlist');
  if(!s.hist.length){l.innerHTML='<div class="empty"><span class="ee">üå±</span>Inga transaktioner √§n.</div>';return;}
  l.innerHTML=s.hist.slice().reverse().map((item,ri)=>{
    const realIdx=s.hist.length-1-ri;
    return histRow(item,realIdx,true);
  }).join('');
}

/* CHORES */
function renderChores(){
  const td=s.chores.reduce((a,c)=>a+c.done,0),tn=s.chores.reduce((a,c)=>a+c.tot,0);
  const pct=tn>0?Math.min(100,(td/tn)*100):0,allDone=tn>0&&td===tn;
  const earned=tn>0?Math.round((td/tn)*s.pamt):0;
  const el=document.getElementById('pearned');
  if(tn>0&&earned>0&&earned<s.pamt){el.style.display='block';el.textContent='Tj√§nat hittills: '+fmt(earned)+' kr';}else el.style.display='none';
  document.getElementById('pamt').textContent=fmt(s.pamt);
  document.getElementById('ppfill').style.width=pct+'%';
  document.getElementById('pppct').textContent=Math.round(pct)+'%';
  document.getElementById('ppleft').textContent=td+' av '+tn+' sysslor klara';
  document.getElementById('psub').textContent=s.pamt===0?'S√§tt ett belopp och l√§gg till sysslor!':allDone?'üéâ Du har f√∂rtj√§nat din m√•nadspeng p√• '+fmt(s.pamt)+' kr!':fmt(s.pamt)+' kr n√§r allt √§r klart';
  const sw2=document.getElementById('sendwrap');
  if(allDone&&s.pamt>0){
    if(!s.mom)sw2.innerHTML='<div style="background:rgba(255,255,255,.15);border-radius:12px;padding:12px;margin-top:12px;font-size:13px;font-weight:700;color:#fff;text-align:center">üí° L√§gg till mammans nummer i Inst√§llningar!</div>';
    else if(s.app==='sms')sw2.innerHTML='<div class="send-wrap"><button class="btn-send bs-sms" style="flex:1" onclick="sendMsg(\'sms\')">üì± Beg√§r min m√•nadspeng via SMS</button></div>';
    else if(s.app==='wa')sw2.innerHTML='<div class="send-wrap"><button class="btn-send bs-wa" style="flex:1" onclick="sendMsg(\'wa\')">üí¨ Beg√§r min m√•nadspeng via WhatsApp</button></div>';
    else sw2.innerHTML='<div class="send-wrap"><button class="btn-send bs-sms" onclick="sendMsg(\'sms\')">üì± SMS</button><button class="btn-send bs-wa" onclick="sendMsg(\'wa\')">üí¨ WhatsApp</button></div>';
  } else sw2.innerHTML='';
  const list=document.getElementById('clist');
  if(!s.chores.length){list.innerHTML='<div class="empty"><span class="ee">üßπ</span>Inga sysslor √§nnu.<br>Tryck p√• "Hantera sysslor" nedan!</div>';return;}
  const pc=tn>0?s.pamt/tn:0;
  list.innerHTML=s.chores.map((c,i)=>{
    const cp=c.tot>0?Math.min(100,(c.done/c.tot)*100):0,ad=c.done>=c.tot,w=Math.round(pc*c.tot);
    return '<div class="cc'+(ad?' done':'')+'"><div class="ci"><div class="cn">'+c.name+'</div><div class="cpt">'+c.done+' / '+c.tot+' g√•nger</div>'+(w>0?'<div class="cet">V√§rd ~'+fmt(w)+' kr</div>':'')+'<div class="cmtrack"><div class="cmfill" style="width:'+cp+'%"></div></div></div><button class="cbtn '+(ad?'ad':'nd')+'" onclick="doChore('+i+')">'+(ad?'‚úÖ':'‚úîÔ∏è')+'</button></div>';
  }).join('');
}

function doChore(i){
  if(s.chores[i].done>=s.chores[i].tot){s.chores[i].done=Math.max(0,s.chores[i].done-1);toast('√Öngrade ett steg ‚Ü©Ô∏è');}
  else{s.chores[i].done++;const c=s.chores[i];
    if(c.done===c.tot){toast('üéâ '+c.name+' klar!');if(s.chores.every(x=>x.done>=x.tot))setTimeout(confetti,300);}
    else toast('‚úîÔ∏è '+c.done+'/'+c.tot+' ‚Äì '+c.name);}
  save();function toggleHelp(id){
  const el=document.getElementById(id);
  const key=id.replace('h-','');
  const arr=document.getElementById('arr-'+key);
  const open=el.style.display==='none';
  el.style.display=open?'block':'none';
  arr.textContent=open?'‚à®':'‚Ä∫';
}
render();
}

function sendMsg(type){
  const nm=s.uname||'Jag';
  const msg=encodeURIComponent('üéâ Hej! '+nm+' har gjort alla sina sysslor och vill beg√§ra sin m√•nadspeng p√• '+fmt(s.pamt)+' kr! üíú');
  const num=s.mom.replace(/\D/g,'');
  if(type==='sms')window.location.href='sms:'+s.mom+'?body='+msg;
  else window.location.href='https://wa.me/'+num+'?text='+msg;
}

function resetChores(){
  if(!s.chores.length){toast('Inga sysslor att √•terst√§lla!');return;}
  openConfirmSheet('resetChoresConfirmed','üîÑ','√Öterst√§ll sysslor?','Alla sysslor nollst√§lls. G√∂r detta i b√∂rjan av en ny period.');
}
function resetChoresConfirmed(){s.chores=s.chores.map(c=>({...c,done:0}));save();render();closeAll();toast('Sysslor √•terst√§llda! üîÑ');}

/* MANAGE */
function openManage(){document.getElementById('pinp').value=s.pamt||'';document.getElementById('cname').value='';document.getElementById('ccnt').value='';renderMC();open2('ms');}
function renderMC(){const l=document.getElementById('mclist');if(!s.chores.length){l.innerHTML='<div style="color:var(--muted);font-size:13px;font-weight:600;text-align:center;padding:10px">Inga sysslor √§nnu</div>';return;}l.innerHTML=s.chores.map((c,i)=>'<div class="mci"><span>'+c.name+'</span><small>'+c.tot+' ggr</small><button class="brc" onclick="rmChore('+i+')">‚úï</button></div>').join('');}
function addChore(){const n=document.getElementById('cname').value.trim(),t=parseInt(document.getElementById('ccnt').value)||1;if(!n){toast('Ange ett namn! üôè');return;}s.chores.push({id:Date.now(),name:n,tot:t,done:0});document.getElementById('cname').value='';document.getElementById('ccnt').value='';renderMC();toast('Syssla tillagd! ‚ú®');}
function rmChore(i){s.chores.splice(i,1);renderMC();}
function saveManage(){const v=parseFloat(document.getElementById('pinp').value);if(v>0)s.pamt=v;save();render();closeAll();toast('Sparat! üéâ');}

/* SHEETS */
const CFG={
  in:{t:'üíµ S√§tt in pengar',d:'Hur mycket pengar s√§tter du in? L√§ggs till totalt saldo.',b:'bc bg',bt:'S√§tt in üíµ',p:'t.ex. Veckopeng, present, jobba‚Ä¶'},
  ear:{t:'üíé Flytta till sparande',d:'Hur mycket vill du flytta till sparandet?',b:'bc bp',bt:'Spara üíé',p:'Anteckning (valfritt)'},
  sp:{t:'üõí Jag handlade',d:'Hur mycket handlade du f√∂r? Dras fr√•n fickpengar.',b:'bc bco',bt:'Dra av üõí',p:'Vad k√∂pte du?'},
  fr:{t:'‚Ü©Ô∏è Flytta fr√•n sparande',d:'Hur mycket vill du flytta tillbaka till fickpengar?',b:'bc bt',bt:'Flytta tillbaka',p:'Varf√∂r?'},
  adj:{t:'‚öñÔ∏è Justera saldo',d:'V√§lj riktning och vilket saldo som ska p√•verkas.',b:'bc bo',bt:'Justera ‚öñÔ∏è',p:'t.ex. Missade k√∂p‚Ä¶'}
};
function openSheet(a){
  act=a;const c=CFG[a];
  document.getElementById('shtit').textContent=c.t;
  document.getElementById('shdesc').textContent=c.d;
  document.getElementById('sbtn').className=c.b;
  document.getElementById('sbtn').textContent=c.bt;
  document.getElementById('snote').placeholder=c.p;
  document.getElementById('samt').value='';document.getElementById('snote').value='';
  const isAdj=a==='adj';
  document.getElementById('atog').style.display=isAdj?'flex':'none';
  document.getElementById('aftog').style.display=isAdj?'flex':'none';
  if(isAdj){setDir(1);setAff('tot');}
  open2('msh');setTimeout(()=>document.getElementById('samt').focus(),300);
}
function open2(id){closeAll();document.getElementById(id).classList.add('visible');document.getElementById('ov').classList.add('visible');}
function openSettings(){open2('set-sheet');}
function openGoal(){document.getElementById('ginp').value=s.gname;document.getElementById('gamt').value=s.gamt||'';open2('gs');setTimeout(()=>document.getElementById('ginp').focus(),300);}
function openEdit(idx){eidx=idx;const item=s.hist[idx],m=IM[item.type]||IM['in'];document.getElementById('etit').textContent=m.e+' Redigera transaktion';document.getElementById('eamt').value=Math.abs(item.amt)||'';document.getElementById('enote').value=item.desc||'';open2('es');setTimeout(()=>document.getElementById('eamt').focus(),300);}
function closeAll(){['msh','es','gs','ms','set-sheet','inp-sheet','conf-sheet'].forEach(id=>document.getElementById(id).classList.remove('visible'));document.getElementById('ov').classList.remove('visible');}
function setDir(d){dir=d;document.getElementById('tp').className='abtn'+(d===1?' ap2':'');document.getElementById('tm').className='abtn'+(d===-1?' am':'');}
function setAff(a){aff=a;['tot','ear','fr'].forEach(k=>document.getElementById('af-'+k).classList.toggle('active',k===a));}

/* INPUT SHEET */
let inpCfg={name:{title:'üë§ Ditt namn',desc:'Vad heter du? Appen h√§lsar dig med r√§tt namn.',ph:'t.ex. Emma'},mom:{title:'üì± Mammans nummer',desc:'Ange nummer med landskod, t.ex. +46701234567',ph:'+46701234567'}};
function openInpSheet(key){
  inpKey=key;const c=inpCfg[key];
  document.getElementById('inp-title').textContent=c.title;
  document.getElementById('inp-desc').textContent=c.desc;
  const inp=document.getElementById('inp-val');
  inp.placeholder=c.ph;
  inp.value=key==='name'?s.uname:s.mom;
  inp.type=key==='mom'?'tel':'text';
  open2('inp-sheet');setTimeout(()=>inp.focus(),300);
}
function saveInp(){
  const v=document.getElementById('inp-val').value.trim();
  if(inpKey==='name')s.uname=v;
  else s.mom=v;
  save();render();
  // Close only inp-sheet, reopen settings
  document.getElementById('inp-sheet').classList.remove('visible');
  document.getElementById('set-sheet').classList.add('visible');
  document.getElementById('ov').classList.add('visible');
  toast(inpKey==='name'?'Namn sparat! üë§':'Nummer sparat! üì±');
}

/* CONFIRM SHEET */
let confCb=null;
function openConfirmSheet(cb,icon,title,desc){
  confCb=cb;
  document.querySelector('#conf-sheet .conf-icon').textContent=icon;
  document.querySelector('#conf-sheet h2').textContent=title;
  document.querySelector('#conf-sheet .ssub').textContent=desc;
  open2('conf-sheet');
}
function openResetConfirm(){openConfirmSheet('resetAll','üóëÔ∏è','√Öterst√§ll all data?','Detta tar bort ALL data ‚Äì saldo, historik, sysslor och sparm√•l. Det g√•r inte att √•ngra!');}
window.resetAll=function(){s={total:0,ear:0,gamt:0,gname:'',pamt:0,chores:[],hist:[],uname:s.uname,mom:s.mom,app:s.app};save();render();closeAll();toast('Data √•terst√§lld üóëÔ∏è');};
window.resetChoresConfirmed=resetChoresConfirmed;
document.querySelector('#conf-sheet .bco').addEventListener('click',()=>{if(confCb&&window[confCb])window[confCb]();});

/* ACTIONS */
function mkSnap(){snap=JSON.parse(JSON.stringify(s));}
function confirm2(){
  const v=parseFloat(document.getElementById('samt').value),note=document.getElementById('snote').value.trim();
  if(!v||v<=0){toast('Ange ett belopp! üôè');return;}
  mkSnap();
  if(act==='in'){s.total+=v;addH('in',note||'Pengar insatta',v);showUndo('+'+fmt(v)+' kr insatta');}
  else if(act==='ear'){if(v>free()){toast('Inte tillr√§ckligt i fickpengar! üò¨');return;}s.ear+=v;addH('ear',note||'Flytta till sparande',v);showUndo(fmt(v)+' kr sparade');if(s.gamt>0&&s.ear>=s.gamt)setTimeout(confetti,300);}
  else if(act==='sp'){if(v>free()){toast('Inte tillr√§ckligt i fickpengar! üò¨');return;}s.total-=v;addH('sp',note||'Handlade',v);showUndo('‚àí'+fmt(v)+' kr draget');}
  else if(act==='fr'){if(v>s.ear){toast('Inte tillr√§ckligt i sparandet! üò¨');return;}s.ear-=v;addH('fr',note||'Flytta fr√•n sparande',v);showUndo(fmt(v)+' kr tillbaka som fickpengar');}
  else if(act==='adj'){
    const sg=dir*v,desc=note||(dir>0?'Justering +':'Justering ‚àí')+fmt(v)+' kr';
    if(aff==='tot'){s.total=Math.max(0,s.total+sg);addH('adj',desc+' (totalt)',sg);}
    else if(aff==='ear'){s.ear=Math.max(0,s.ear+sg);s.total=Math.max(s.ear,s.total+sg);addH('adj',desc+' (sparande)',sg);}
    else{s.total=Math.max(s.ear,s.total+sg);addH('adj',desc+' (fickpengar)',sg);}
    showUndo('Saldo justerat');
  }
  save();render();closeAll();
}
function saveEdit(){
  if(eidx<0)return;const v=parseFloat(document.getElementById('eamt').value),note=document.getElementById('enote').value.trim();
  if(!v||v<=0){toast('Ange ett belopp! üôè');return;}
  mkSnap();s.hist[eidx].amt=v;if(note)s.hist[eidx].desc=note;
  save();render();closeAll();toast('Historik uppdaterad ‚úÖ');
}
function delEntry(){if(eidx<0)return;mkSnap();s.hist.splice(eidx,1);save();render();closeAll();toast('Transaktion borttagen üóë');}
function saveGoal(){
  const n=document.getElementById('ginp').value.trim(),v=parseFloat(document.getElementById('gamt').value);
  if(!v||v<=0){toast('Ange ett m√•lbelopp! üéØ');return;}
  s.gname=n||'Mitt m√•l';s.gamt=v;addH('goal','Nytt m√•l: '+s.gname,v);
  save();render();closeAll();toast('Sparm√•l sparat! üéØ');
}

/* SETTINGS */
function setApp(a){s.app=a;save();renderSett();render();}
function exportB(){
  const blob=new Blob([JSON.stringify(s,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob),a=document.createElement('a');
  a.href=url;a.download='mina-pengar-backup-'+new Date().toISOString().slice(0,10)+'.json';a.click();URL.revokeObjectURL(url);
  toast('Backup exporterad! üíæ');
}
function importB(e){
  const file=e.target.files[0];if(!file)return;
  const r=new FileReader();
  r.onload=ev=>{try{const d=JSON.parse(ev.target.result);if(d.total===undefined)throw 0;openConfirmSheet('doImport','üì•','Importera backup?','All nuvarande data ers√§tts med backup-filen.');window._importData=d;}catch{toast('Ogiltig backup-fil! ‚ùå');}};
  r.readAsText(file);e.target.value='';
}
window.doImport=function(){if(window._importData){s={...s,...window._importData};save();render();closeAll();toast('Backup importerad! üì•');}};

/* UNDO */
function showUndo(msg){document.getElementById('umsg').textContent=msg;const b=document.getElementById('ub');b.classList.add('visible');clearTimeout(utmr);utmr=setTimeout(()=>{b.classList.remove('visible');snap=null;},5000);}
function undo(){if(!snap)return;s=snap;snap=null;save();render();document.getElementById('ub').classList.remove('visible');toast('√Öngrat! ‚Ü©Ô∏è');}

/* TOAST */
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2600);}

/* CONFETTI */
function confetti(){
  const cv=document.getElementById('cc'),ctx=cv.getContext('2d');
  cv.width=window.innerWidth;cv.height=window.innerHeight;
  const pp=[],cols=['#7C5CBF','#E91E8C','#F5A623','#27AE60','#1ABC9C','#FF6B6B','#FFD700'];
  for(let i=0;i<120;i++)pp.push({x:Math.random()*cv.width,y:-10-Math.random()*100,w:6+Math.random()*8,h:8+Math.random()*10,r:Math.random()*Math.PI*2,vx:(Math.random()-.5)*4,vy:2+Math.random()*3,vr:(Math.random()-.5)*.2,col:cols[Math.floor(Math.random()*cols.length)],al:1});
  let fr=0;
  (function draw(){ctx.clearRect(0,0,cv.width,cv.height);pp.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.r+=p.vr;p.al=Math.max(0,1-fr/90);ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.r);ctx.globalAlpha=p.al;ctx.fillStyle=p.col;ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);ctx.restore();});fr++;if(fr<100)requestAnimationFrame(draw);else ctx.clearRect(0,0,cv.width,cv.height);})();
}

/* ENTER KEYS */
document.getElementById('samt').addEventListener('keydown',e=>{if(e.key==='Enter')confirm2();});
document.getElementById('eamt').addEventListener('keydown',e=>{if(e.key==='Enter')saveEdit();});
document.getElementById('gamt').addEventListener('keydown',e=>{if(e.key==='Enter')saveGoal();});
document.getElementById('cname').addEventListener('keydown',e=>{if(e.key==='Enter')addChore();});
document.getElementById('inp-val').addEventListener('keydown',e=>{if(e.key==='Enter')saveInp();});

render();
</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log('SW registered'))
        .catch(err => console.log('SW failed', err));
    });
  }
</script>
</body>
</html>
