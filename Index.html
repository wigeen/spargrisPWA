<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Mina Pengar" />
  <title>Mina Pengar üíú</title>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#7C5CBF" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #F7F3FF; --card: #FFFFFF;
      --primary: #7C5CBF; --primary-light: #EDE8FA;
      --green: #27AE60; --green-light: #E6F7EE;
      --coral: #FF6B6B; --coral-light: #FFE8E8;
      --gold: #F5A623; --gold-light: #FEF5E4;
      --teal: #1ABC9C; --teal-light: #E6F9F5;
      --orange: #E67E22; --orange-light: #FDF0E6;
      --pink: #E91E8C; --pink-light: #FCE4F3;
      --text: #1A1A2E; --text-muted: #9A9AB0;
      --border: #EDE8F5;
      --shadow: 0 4px 24px rgba(124,92,191,0.08);
      --radius: 22px; --radius-sm: 14px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Nunito', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }
    body::before { content:''; position:fixed; top:-140px; right:-100px; width:380px; height:380px; background:radial-gradient(circle,#D9CCFF 0%,transparent 70%); border-radius:50%; z-index:0; pointer-events:none; }
    body::after  { content:''; position:fixed; bottom:-120px; left:-80px; width:320px; height:320px; background:radial-gradient(circle,#C8F5E9 0%,transparent 70%); border-radius:50%; z-index:0; pointer-events:none; }
    #confetti-canvas { position:fixed; inset:0; z-index:999; pointer-events:none; }
    .tab-bar { position:fixed; bottom:0; left:0; right:0; z-index:50; background:rgba(255,255,255,0.94); backdrop-filter:blur(16px); border-top:1.5px solid var(--border); display:flex; max-width:420px; margin:0 auto; padding-bottom:env(safe-area-inset-bottom,0px); }
    .tab-btn { flex:1; display:flex; flex-direction:column; align-items:center; gap:3px; padding:10px 6px 8px; background:none; border:none; cursor:pointer; font-family:'Nunito',sans-serif; font-size:10px; font-weight:800; color:var(--text-muted); transition:color 0.18s; letter-spacing:0.3px; }
    .tab-btn .tab-icon { font-size:22px; transition:transform 0.18s; }
    .tab-btn.active { color:var(--primary); }
    .tab-btn.active .tab-icon { transform:scale(1.15); }
    .page { display:none; position:relative; z-index:1; max-width:420px; margin:0 auto; padding:0 16px 100px; }
    .page.active { display:block; }
    .header { padding:52px 0 20px; text-align:center; animation:fadeDown 0.5s ease both; }
    .header-emoji { font-size:42px; display:block; margin-bottom:6px; }
    .header h1 { font-family:'DM Serif Display',serif; font-size:32px; letter-spacing:-0.5px; }
    .header p { font-size:13px; color:var(--text-muted); margin-top:4px; font-weight:600; }
    .chores-header { padding:52px 0 20px; animation:fadeDown 0.5s ease both; }
    .chores-header h1 { font-family:'DM Serif Display',serif; font-size:28px; letter-spacing:-0.5px; }
    .chores-header p { font-size:13px; color:var(--text-muted); margin-top:4px; font-weight:600; }
    .card-total { background:linear-gradient(135deg,#7C5CBF 0%,#5B3FA0 100%); border-radius:var(--radius); padding:26px 24px 22px; margin-bottom:14px; box-shadow:0 8px 32px rgba(124,92,191,0.28); animation:fadeUp 0.45s ease both; position:relative; overflow:hidden; }
    .card-total::before { content:''; position:absolute; top:-40px; right:-40px; width:160px; height:160px; background:rgba(255,255,255,0.08); border-radius:50%; }
    .total-label { font-size:11px; font-weight:800; letter-spacing:1.4px; text-transform:uppercase; color:rgba(255,255,255,0.65); margin-bottom:8px; }
    .total-amount { font-family:'DM Serif Display',serif; font-size:52px; color:#fff; line-height:1; letter-spacing:-1.5px; }
    .total-amount .currency { font-size:26px; vertical-align:super; margin-right:3px; }
    .total-sub { font-size:12px; color:rgba(255,255,255,0.55); font-weight:600; margin-top:8px; }
    .card-peng { background:linear-gradient(135deg,#E91E8C 0%,#B5106A 100%); border-radius:var(--radius); padding:22px 22px 18px; margin-bottom:14px; box-shadow:0 8px 32px rgba(233,30,140,0.25); animation:fadeUp 0.45s ease both; position:relative; overflow:hidden; }
    .card-peng::before { content:''; position:absolute; top:-40px; right:-40px; width:150px; height:150px; background:rgba(255,255,255,0.08); border-radius:50%; }
    .peng-label { font-size:11px; font-weight:800; letter-spacing:1.4px; text-transform:uppercase; color:rgba(255,255,255,0.65); margin-bottom:6px; }
    .peng-amount { font-family:'DM Serif Display',serif; font-size:42px; color:#fff; line-height:1; letter-spacing:-1px; }
    .peng-amount .currency { font-size:22px; vertical-align:super; margin-right:2px; }
    .peng-earned { font-size:13px; color:rgba(255,255,255,0.8); font-weight:800; margin-top:4px; }
    .peng-sub { font-size:12px; color:rgba(255,255,255,0.6); font-weight:600; margin-top:2px; }
    .peng-progress-wrap { margin-top:14px; }
    .peng-progress-track { background:rgba(255,255,255,0.2); border-radius:999px; height:10px; overflow:hidden; margin-bottom:6px; }
    .peng-progress-fill { height:100%; background:#fff; border-radius:999px; transition:width 0.7s cubic-bezier(.4,0,.2,1); min-width:5px; }
    .peng-progress-labels { display:flex; justify-content:space-between; font-size:11px; font-weight:800; color:rgba(255,255,255,0.7); }
    .peng-progress-pct { color:#fff; }
    .btn-request-peng { width:100%; margin-top:14px; padding:14px; border:none; border-radius:var(--radius-sm); background:rgba(255,255,255,0.2); color:#fff; font-family:'Nunito',sans-serif; font-size:15px; font-weight:900; cursor:pointer; transition:background 0.18s, transform 0.14s; letter-spacing:0.3px; }
    .btn-request-peng:active { transform:scale(0.97); background:rgba(255,255,255,0.3); }
    .btn-reset-chores { width:100%; padding:12px; border:2px solid rgba(255,255,255,0.3); border-radius:var(--radius-sm); background:transparent; color:rgba(255,255,255,0.8); font-family:'Nunito',sans-serif; font-size:13px; font-weight:800; cursor:pointer; transition:all 0.18s; margin-top:8px; }
    .btn-reset-chores:active { background:rgba(255,255,255,0.15); }
    .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:14px; animation:fadeUp 0.45s ease 0.07s both; }
    .card { background:var(--card); border-radius:var(--radius); padding:18px 18px 16px; box-shadow:var(--shadow); border:1.5px solid var(--border); }
    .card-label { font-size:11px; font-weight:800; letter-spacing:1.2px; text-transform:uppercase; margin-bottom:6px; }
    .card-amount { font-family:'DM Serif Display',serif; font-size:28px; line-height:1.1; letter-spacing:-0.5px; }
    .card-amount .currency { font-size:15px; vertical-align:super; margin-right:2px; }
    .card-sub { font-size:11px; font-weight:600; margin-top:4px; color:var(--text-muted); }
    .card-saving .card-label,.card-saving .card-amount { color:#6A4FCF; }
    .card-pocket .card-label,.card-pocket .card-amount { color:var(--teal); }
    .card-goal { background:var(--card); border-radius:var(--radius); padding:20px 20px 18px; box-shadow:var(--shadow); border:1.5px solid var(--border); margin-bottom:14px; animation:fadeUp 0.45s ease 0.1s both; }
    .goal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .goal-name-label { font-size:11px; font-weight:800; letter-spacing:1.2px; text-transform:uppercase; color:var(--gold); margin-bottom:3px; }
    .goal-name { font-size:15px; font-weight:800; }
    .goal-amounts { display:flex; align-items:baseline; gap:6px; margin-bottom:12px; }
    .goal-current { font-family:'DM Serif Display',serif; font-size:26px; color:var(--gold); }
    .goal-sep { color:var(--text-muted); font-weight:700; font-size:14px; }
    .goal-target { font-size:16px; color:var(--text-muted); font-weight:700; }
    .progress-track { border-radius:999px; height:12px; overflow:hidden; margin-bottom:8px; }
    .progress-track.gold { background:var(--gold-light); }
    .progress-fill { height:100%; border-radius:999px; transition:width 0.7s cubic-bezier(.4,0,.2,1); min-width:5px; }
    .progress-fill.gold { background:linear-gradient(90deg,#F5A623,#FF8C42); }
    .progress-labels { display:flex; justify-content:space-between; font-size:11px; font-weight:700; }
    .progress-left { color:var(--text-muted); }
    .progress-pct { font-weight:900; font-size:12px; color:var(--gold); }
    .btn-ghost { background:none; border:2px solid var(--border); border-radius:10px; padding:5px 11px; font-family:'Nunito',sans-serif; font-size:11px; font-weight:800; color:var(--text-muted); cursor:pointer; transition:all 0.18s; }
    .btn-ghost:active { transform:scale(0.95); background:var(--border); }
    .actions { margin-bottom:16px; animation:fadeUp 0.45s ease 0.15s both; }
    .section-title { font-size:11px; font-weight:800; letter-spacing:1.2px; text-transform:uppercase; color:var(--text-muted); margin-bottom:10px; padding:0 2px; }
    .actions-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .btn-action { display:flex; flex-direction:column; align-items:center; gap:7px; padding:18px 10px 16px; border-radius:var(--radius); border:1.5px solid transparent; font-family:'Nunito',sans-serif; font-weight:800; font-size:12px; cursor:pointer; transition:transform 0.14s, box-shadow 0.14s; box-shadow:var(--shadow); text-align:center; line-height:1.2; }
    .btn-action:active { transform:scale(0.94); box-shadow:none; }
    .btn-action .action-emoji { font-size:28px; }
    .btn-in      { background:var(--green-light);  color:#1A8A49; border-color:#C0EDD4; }
    .btn-earmark { background:var(--primary-light); color:#5B3FA0; border-color:#D4C8F5; }
    .btn-spend   { background:var(--coral-light);  color:#C94040; border-color:#FFCACA; }
    .btn-free    { background:var(--teal-light);   color:#0E8A72; border-color:#A8EAD9; }
    .btn-adjust  { background:var(--orange-light); color:#A05010; border-color:#F5CCB0; }
    .history-section { animation:fadeUp 0.45s ease 0.2s both; }
    .history-list { display:flex; flex-direction:column; gap:8px; }
    .history-item { background:var(--card); border-radius:var(--radius-sm); padding:13px 15px 20px; display:flex; align-items:center; gap:12px; box-shadow:0 2px 8px rgba(124,92,191,0.06); border:1.5px solid var(--border); cursor:pointer; transition:transform 0.12s; position:relative; }
    .history-item:active { transform:scale(0.98); }
    .history-icon { width:38px; height:38px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:17px; flex-shrink:0; }
    .hi-green{background:var(--green-light);} .hi-purple{background:var(--primary-light);} .hi-coral{background:var(--coral-light);} .hi-teal{background:var(--teal-light);} .hi-orange{background:var(--orange-light);}
    .history-text { flex:1; min-width:0; }
    .history-desc { font-size:13px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .history-date { font-size:11px; color:var(--text-muted); margin-top:1px; font-weight:600; }
    .history-amount { font-size:14px; font-weight:900; flex-shrink:0; }
    .ha-green{color:var(--green);} .ha-purple{color:var(--primary);} .ha-coral{color:var(--coral);} .ha-teal{color:var(--teal);} .ha-orange{color:var(--orange);}
    .edit-hint { font-size:10px; color:var(--text-muted); position:absolute; right:15px; bottom:6px; font-weight:700; }
    .empty-state { text-align:center; padding:32px 20px; color:var(--text-muted); font-size:14px; font-weight:600; line-height:1.6; }
    .empty-state .empty-emoji { font-size:38px; display:block; margin-bottom:10px; }
    .chore-card { background:var(--card); border-radius:var(--radius-sm); padding:14px 16px; display:flex; align-items:center; gap:12px; box-shadow:0 2px 8px rgba(124,92,191,0.06); border:1.5px solid var(--border); margin-bottom:8px; transition:opacity 0.3s; }
    .chore-card.done { opacity:0.5; }
    .chore-info { flex:1; min-width:0; }
    .chore-name { font-size:14px; font-weight:800; margin-bottom:2px; }
    .chore-progress-text { font-size:11px; color:var(--text-muted); font-weight:700; }
    .chore-earned-text { font-size:11px; color:var(--pink); font-weight:800; }
    .chore-mini-track { background:var(--pink-light); border-radius:999px; height:6px; margin-top:6px; overflow:hidden; }
    .chore-mini-fill { height:100%; background:linear-gradient(90deg,#E91E8C,#FF6B9D); border-radius:999px; transition:width 0.4s ease; }
    .chore-btn { width:40px; height:40px; border-radius:50%; border:none; flex-shrink:0; font-size:18px; cursor:pointer; transition:transform 0.15s; display:flex; align-items:center; justify-content:center; }
    .chore-btn.not-done { background:var(--pink-light); color:var(--pink); }
    .chore-btn.not-done:active { transform:scale(0.88); }
    .chore-btn.all-done { background:var(--green-light); color:var(--green); }
    .chore-manage-btn { width:100%; padding:14px; border-radius:var(--radius-sm); border:2px dashed var(--border); background:none; font-family:'Nunito',sans-serif; font-size:14px; font-weight:800; color:var(--text-muted); cursor:pointer; margin-top:4px; transition:all 0.18s; }
    .chore-manage-btn:active { background:var(--card); }
    .overlay { position:fixed; inset:0; background:rgba(26,26,46,0.4); backdrop-filter:blur(5px); z-index:100; opacity:0; pointer-events:none; transition:opacity 0.25s; }
    .overlay.visible { opacity:1; pointer-events:all; }
    .sheet { position:fixed; bottom:0; left:0; right:0; background:var(--card); border-radius:28px 28px 0 0; padding:20px 22px 44px; transform:translateY(100%); transition:transform 0.32s cubic-bezier(.4,0,.2,1); z-index:101; max-width:420px; margin:0 auto; }
    .sheet.visible { transform:translateY(0); }
    .sheet-handle { width:40px; height:5px; background:var(--border); border-radius:99px; margin:0 auto 20px; }
    .sheet h2 { font-family:'DM Serif Display',serif; font-size:24px; margin-bottom:4px; }
    .sheet-sub { font-size:13px; color:var(--text-muted); font-weight:600; margin-bottom:20px; line-height:1.5; }
    .adjust-toggle { display:flex; gap:8px; margin-bottom:12px; }
    .toggle-btn { flex:1; padding:11px; border-radius:var(--radius-sm); border:2px solid var(--border); background:var(--bg); font-family:'Nunito',sans-serif; font-size:14px; font-weight:800; cursor:pointer; transition:all 0.15s; color:var(--text-muted); }
    .toggle-btn.active-plus  { background:var(--green-light); border-color:var(--green); color:var(--green); }
    .toggle-btn.active-minus { background:var(--coral-light); border-color:var(--coral); color:var(--coral); }
    .affect-toggle { display:flex; gap:8px; margin-bottom:14px; }
    .affect-btn { flex:1; padding:9px 4px; border-radius:var(--radius-sm); border:2px solid var(--border); background:var(--bg); font-family:'Nunito',sans-serif; font-size:11px; font-weight:800; cursor:pointer; transition:all 0.15s; color:var(--text-muted); text-align:center; line-height:1.4; }
    .affect-btn.active { background:var(--primary-light); border-color:var(--primary); color:var(--primary); }
    .input-wrap { position:relative; margin-bottom:12px; }
    .input-prefix { position:absolute; left:16px; top:50%; transform:translateY(-50%); font-size:22px; font-weight:900; color:var(--text-muted); pointer-events:none; font-family:'DM Serif Display',serif; }
    .amount-input { width:100%; background:var(--bg); border:2px solid var(--border); border-radius:var(--radius-sm); padding:15px 16px 15px 36px; font-family:'DM Serif Display',serif; font-size:34px; color:var(--text); outline:none; transition:border-color 0.18s; -moz-appearance:textfield; }
    .amount-input::-webkit-outer-spin-button,.amount-input::-webkit-inner-spin-button { -webkit-appearance:none; }
    .amount-input:focus { border-color:var(--primary); }
    .note-input { width:100%; background:var(--bg); border:2px solid var(--border); border-radius:var(--radius-sm); padding:13px 16px; font-family:'Nunito',sans-serif; font-size:15px; font-weight:600; color:var(--text); outline:none; margin-bottom:14px; transition:border-color 0.18s; }
    .note-input:focus { border-color:var(--primary); }
    .note-input::placeholder { color:var(--text-muted); }
    .number-input { width:100%; background:var(--bg); border:2px solid var(--border); border-radius:var(--radius-sm); padding:13px 16px; font-family:'Nunito',sans-serif; font-size:20px; font-weight:800; color:var(--text); outline:none; margin-bottom:14px; transition:border-color 0.18s; -moz-appearance:textfield; }
    .number-input::-webkit-outer-spin-button,.number-input::-webkit-inner-spin-button { -webkit-appearance:none; }
    .number-input:focus { border-color:var(--pink); }
    .btn-confirm { width:100%; padding:17px; border:none; border-radius:var(--radius-sm); font-family:'Nunito',sans-serif; font-size:16px; font-weight:900; cursor:pointer; transition:transform 0.14s, box-shadow 0.14s; box-shadow:var(--shadow); }
    .btn-confirm:active { transform:scale(0.97); box-shadow:none; }
    .btn-green{background:var(--green);color:#fff;} .btn-gold{background:var(--gold);color:#fff;} .btn-coral{background:var(--coral);color:#fff;} .btn-teal{background:var(--teal);color:#fff;} .btn-purple{background:var(--primary);color:#fff;} .btn-orange{background:var(--orange);color:#fff;} .btn-pink{background:var(--pink);color:#fff;}
    .sheet-row-btns { display:flex; gap:10px; }
    .btn-delete { flex:0 0 auto; padding:17px 18px; border:none; border-radius:var(--radius-sm); background:var(--coral-light); color:var(--coral); font-size:20px; cursor:pointer; transition:transform 0.14s; }
    .btn-delete:active { transform:scale(0.95); }
    .manage-chore-item { background:var(--bg); border-radius:var(--radius-sm); padding:12px 14px; display:flex; align-items:center; gap:10px; margin-bottom:8px; border:1.5px solid var(--border); }
    .manage-chore-item span { flex:1; font-size:13px; font-weight:700; }
    .manage-chore-item small { font-size:11px; color:var(--text-muted); font-weight:600; }
    .btn-remove-chore { background:none; border:none; font-size:18px; cursor:pointer; padding:2px 4px; color:var(--coral); }
    .undo-bar { position:fixed; bottom:72px; left:50%; transform:translateX(-50%) translateY(80px); background:var(--text); color:#fff; border-radius:999px; padding:13px 18px; display:flex; align-items:center; gap:14px; font-size:13px; font-weight:700; z-index:300; box-shadow:0 6px 24px rgba(0,0,0,0.25); transition:transform 0.3s cubic-bezier(.4,0,.2,1), opacity 0.3s; opacity:0; pointer-events:none; white-space:nowrap; }
    .undo-bar.visible { transform:translateX(-50%) translateY(0); opacity:1; pointer-events:all; }
    .undo-btn { background:rgba(255,255,255,0.2); border:none; color:#fff; font-family:'Nunito',sans-serif; font-size:13px; font-weight:900; padding:6px 14px; border-radius:999px; cursor:pointer; }
    .toast { position:fixed; top:58px; left:50%; transform:translateX(-50%) translateY(-16px); background:var(--text); color:#fff; border-radius:999px; padding:12px 22px; font-size:14px; font-weight:700; z-index:400; opacity:0; transition:opacity 0.2s, transform 0.2s; white-space:nowrap; pointer-events:none; box-shadow:0 4px 20px rgba(0,0,0,0.2); }
    .toast.show { opacity:1; transform:translateX(-50%) translateY(0); }
    #edit-sheet{z-index:102;} #goal-sheet{z-index:103;} #manage-sheet{z-index:103;}
    @keyframes fadeUp   { from{opacity:0;transform:translateY(22px);}  to{opacity:1;transform:translateY(0);} }
    @keyframes fadeDown { from{opacity:0;transform:translateY(-16px);} to{opacity:1;transform:translateY(0);} }
  </style>
</head>
<body>
<canvas id="confetti-canvas"></canvas>

<div class="page active" id="page-pengar">
  <div class="header">
    <span class="header-emoji">üíú</span>
    <h1>Mina Pengar</h1>
    <p id="greeting">Hej! Kolla din ekonomi üëã</p>
  </div>
  <div class="card-total">
    <div class="total-label">Totalt saldo</div>
    <div class="total-amount"><span class="currency">kr</span><span id="total-amount">0</span></div>
    <div class="total-sub" id="total-sub">S√§tt in pengar f√∂r att b√∂rja!</div>
  </div>
  <div class="grid-2">
    <div class="card card-saving">
      <div class="card-label">üíé Sparande</div>
      <div class="card-amount"><span class="currency">kr</span><span id="earmarked-amount">0</span></div>
      <div class="card-sub">Mot ditt m√•l</div>
    </div>
    <div class="card card-pocket">
      <div class="card-label">üí∞ Fickpengar</div>
      <div class="card-amount"><span class="currency">kr</span><span id="free-amount">0</span></div>
      <div class="card-sub">Att handla f√∂r</div>
    </div>
  </div>
  <div class="card-goal">
    <div class="goal-header">
      <div>
        <div class="goal-name-label">üéØ Sparm√•l</div>
        <div class="goal-name" id="goal-name">S√§tt ett m√•l!</div>
      </div>
      <button class="btn-ghost" onclick="openGoalSheet()">√Ñndra m√•l</button>
    </div>
    <div class="goal-amounts">
      <span class="goal-current" id="goal-current">0</span>
      <span class="goal-sep">av</span>
      <span class="goal-target" id="goal-target">0 kr</span>
    </div>
    <div class="progress-track gold"><div class="progress-fill gold" id="progress-fill" style="width:0%"></div></div>
    <div class="progress-labels">
      <span class="progress-left" id="goal-left">S√§tt ett m√•l f√∂r att b√∂rja!</span>
      <span class="progress-pct" id="goal-pct">0%</span>
    </div>
  </div>
  <div class="actions">
    <div class="section-title">Vad vill du g√∂ra?</div>
    <div class="actions-grid">
      <button class="btn-action btn-in"      onclick="openSheet('in')">     <span class="action-emoji">üíµ</span>S√§tt in pengar</button>
      <button class="btn-action btn-earmark" onclick="openSheet('earmark')"><span class="action-emoji">üíé</span>Flytta till sparande</button>
      <button class="btn-action btn-spend"   onclick="openSheet('spend')">  <span class="action-emoji">üõí</span>Jag handlade</button>
      <button class="btn-action btn-free"    onclick="openSheet('unearn')"> <span class="action-emoji">‚Ü©Ô∏è</span>Flytta fr√•n sparande</button>
      <button class="btn-action btn-adjust" style="grid-column:1/-1;" onclick="openSheet('adjust')">
        <span class="action-emoji">‚öñÔ∏è</span>Justera / Kalibrera saldo
      </button>
    </div>
  </div>
  <div class="history-section">
    <div class="section-title">Historik ‚Äì tryck f√∂r att redigera</div>
    <div class="history-list" id="history-list"></div>
  </div>
</div>

<div class="page" id="page-sysslor">
  <div class="chores-header">
    <h1>üßπ Mina Sysslor</h1>
    <p id="chores-greeting">G√∂r klart dina sysslor f√∂r att f√• din peng!</p>
  </div>
  <div class="card-peng">
    <div class="peng-label">üí∞ M√•nadspeng / Veckopeng</div>
    <div class="peng-amount"><span class="currency">kr</span><span id="peng-amount">0</span></div>
    <div class="peng-earned" id="peng-earned" style="display:none;"></div>
    <div class="peng-sub" id="peng-sub">S√§tt ett belopp och l√§gg till sysslor!</div>
    <div class="peng-progress-wrap">
      <div class="peng-progress-track"><div class="peng-progress-fill" id="peng-progress-fill" style="width:0%"></div></div>
      <div class="peng-progress-labels">
        <span id="peng-progress-left">0 av 0 sysslor klara</span>
        <span class="peng-progress-pct" id="peng-progress-pct">0%</span>
      </div>
    </div>
    <button class="btn-request-peng" id="btn-request-peng" style="display:none;" onclick="requestPeng()">üéâ Beg√§r min peng!</button>
    <button class="btn-reset-chores" onclick="confirmResetChores()">üîÑ √Öterst√§ll sysslor (ny period)</button>
  </div>
  <div class="section-title" style="margin-bottom:10px;">Sysslor att g√∂ra</div>
  <div id="chore-list"></div>
  <button class="chore-manage-btn" onclick="openManageSheet()">‚öôÔ∏è Hantera sysslor & peng</button>
</div>

<div class="tab-bar">
  <button class="tab-btn active" id="tab-pengar"  onclick="switchTab('pengar')"> <span class="tab-icon">üíú</span>Mina Pengar</button>
  <button class="tab-btn"        id="tab-sysslor" onclick="switchTab('sysslor')"><span class="tab-icon">üßπ</span>Sysslor</button>
</div>

<div class="overlay" id="overlay" onclick="closeAllSheets()"></div>

<div class="sheet" id="main-sheet">
  <div class="sheet-handle"></div>
  <h2 id="sheet-title">‚Äì</h2>
  <div class="sheet-sub" id="sheet-desc">‚Äì</div>
  <div class="adjust-toggle" id="adjust-toggle" style="display:none;">
    <button class="toggle-btn active-plus" id="toggle-plus" onclick="setDir(1)">‚ûï L√§gga till</button>
    <button class="toggle-btn" id="toggle-minus" onclick="setDir(-1)">‚ûñ Dra av</button>
  </div>
  <div class="affect-toggle" id="affect-toggle" style="display:none;">
    <button class="affect-btn active" id="aff-total"   onclick="setAffect('total')">üíú Totalt<br>saldo</button>
    <button class="affect-btn"        id="aff-earmark" onclick="setAffect('earmark')">üíé Spa-<br>rande</button>
    <button class="affect-btn"        id="aff-free"    onclick="setAffect('free')">üí∞ Fick-<br>pengar</button>
  </div>
  <div class="input-wrap"><span class="input-prefix">kr</span><input class="amount-input" type="number" id="sheet-amount" placeholder="0" inputmode="decimal"/></div>
  <input class="note-input" type="text" id="sheet-note" placeholder="Anteckning (valfritt)"/>
  <button class="btn-confirm" id="sheet-btn" onclick="confirmAction()">Bekr√§fta</button>
</div>

<div class="sheet" id="edit-sheet">
  <div class="sheet-handle"></div>
  <h2 id="edit-title">Redigera</h2>
  <div class="sheet-sub">√Ñndra beloppet eller anteckningen. Vill du korrigera saldot? Anv√§nd ‚öñÔ∏è Justera.</div>
  <div class="input-wrap"><span class="input-prefix">kr</span><input class="amount-input" type="number" id="edit-amount" placeholder="0" inputmode="decimal"/></div>
  <input class="note-input" type="text" id="edit-note" placeholder="Anteckning"/>
  <div class="sheet-row-btns">
    <button class="btn-delete" onclick="deleteEntry()">üóë</button>
    <button class="btn-confirm btn-purple" style="flex:1;" onclick="saveEdit()">Spara √§ndringar</button>
  </div>
</div>

<div class="sheet" id="goal-sheet">
  <div class="sheet-handle"></div>
  <h2>üéØ S√§tt ett sparm√•l</h2>
  <div class="sheet-sub">Vad sparar du till?</div>
  <input class="note-input" type="text" id="goal-name-input" placeholder="t.ex. H√∂rlurar, Resa, Spelkonsol‚Ä¶"/>
  <div class="input-wrap"><span class="input-prefix">kr</span><input class="amount-input" type="number" id="goal-target-input" placeholder="0" inputmode="decimal"/></div>
  <div style="height:14px;"></div>
  <button class="btn-confirm btn-gold" onclick="saveGoal()">Spara m√•l üéØ</button>
</div>

<div class="sheet" id="manage-sheet">
  <div class="sheet-handle"></div>
  <h2>‚öôÔ∏è Hantera sysslor</h2>
  <div class="sheet-sub">L√§gg till sysslor och s√§tt belopp.</div>
  <div style="font-size:11px;font-weight:800;letter-spacing:1px;text-transform:uppercase;color:var(--text-muted);margin-bottom:8px;">üí∞ Peng n√§r allt √§r klart</div>
  <div class="input-wrap" style="margin-bottom:14px;"><span class="input-prefix">kr</span><input class="amount-input" type="number" id="peng-target-input" placeholder="0" inputmode="decimal" style="font-size:28px;"/></div>
  <div style="font-size:11px;font-weight:800;letter-spacing:1px;text-transform:uppercase;color:var(--text-muted);margin-bottom:8px;">‚ûï Ny syssla</div>
  <input class="note-input" type="text" id="new-chore-name" placeholder="t.ex. St√§da rummet, Diska, Handla‚Ä¶" style="margin-bottom:8px;"/>
  <div style="display:flex;gap:8px;margin-bottom:14px;">
    <div style="flex:1;">
      <div style="font-size:11px;font-weight:700;color:var(--text-muted);margin-bottom:4px;">Antal g√•nger</div>
      <input class="number-input" type="number" id="new-chore-count" placeholder="1" inputmode="numeric" min="1" style="margin-bottom:0;"/>
    </div>
  </div>
  <button class="btn-confirm btn-pink" onclick="addChore()" style="margin-bottom:16px;">L√§gg till syssla ‚ú®</button>
  <div style="font-size:11px;font-weight:800;letter-spacing:1px;text-transform:uppercase;color:var(--text-muted);margin-bottom:8px;">üìã Befintliga sysslor</div>
  <div id="manage-chore-list"></div>
  <div style="height:10px;"></div>
  <button class="btn-confirm btn-purple" onclick="saveManage()">Spara allt ‚úÖ</button>
</div>

<div class="undo-bar" id="undo-bar"><span id="undo-msg">Klar!</span><button class="undo-btn" onclick="undoLast()">√Öngra</button></div>
<div class="toast" id="toast"></div>

<script>
  let s=JSON.parse(localStorage.getItem('mina-pengar-v4')||'null')||{total:0,earmarked:0,goalAmount:0,goalName:'',pengAmount:0,chores:[],history:[]};
  let snapshot=null,undoTimer=null,currentAction='',adjustDir=1,adjustAffect='total',editIdx=-1;
  function persist(){localStorage.setItem('mina-pengar-v4',JSON.stringify(s));}
  function free(){return Math.max(0,s.total-s.earmarked);}
  function switchTab(tab){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.getElementById('page-'+tab).classList.add('active');document.getElementById('tab-'+tab).classList.add('active');}
  function render(){
    document.getElementById('total-amount').textContent=fmt(s.total);
    document.getElementById('earmarked-amount').textContent=fmt(s.earmarked);
    document.getElementById('free-amount').textContent=fmt(free());
    document.getElementById('total-sub').textContent=s.total===0?'S√§tt in pengar f√∂r att b√∂rja!':fmt(s.earmarked)+' kr sparande ¬∑ '+fmt(free())+' kr fickpengar';
    document.getElementById('goal-name').textContent=s.goalName||'S√§tt ett m√•l!';
    document.getElementById('goal-current').textContent=fmt(s.earmarked);
    document.getElementById('goal-target').textContent=fmt(s.goalAmount)+' kr';
    const gPct=s.goalAmount>0?Math.min(100,(s.earmarked/s.goalAmount)*100):0;
    document.getElementById('progress-fill').style.width=gPct+'%';
    document.getElementById('goal-pct').textContent=Math.round(gPct)+'%';
    document.getElementById('goal-left').textContent=gPct>=100&&s.goalAmount>0?'üéâ M√•l uppn√•tt!':s.goalAmount>0?fmt(Math.max(0,s.goalAmount-s.earmarked))+' kr kvar':'S√§tt ett m√•l f√∂r att b√∂rja!';
    renderChores();renderHistory();updateGreeting();
  }
  function fmt(n){return Math.round(n).toLocaleString('sv-SE');}
  function updateGreeting(){
    const h=new Date().getHours();
    const g=h<5?'God natt':h<10?'God morgon':h<18?'Hej':'God kv√§ll';
    const gPct=s.goalAmount>0?Math.min(100,(s.earmarked/s.goalAmount)*100):0;
    let status='Kolla din ekonomi üëã';
    if(s.goalAmount>0&&gPct>=100)status='üéâ Du har n√•tt ditt sparm√•l!';
    else if(s.total>0&&s.goalAmount>0)status='Du √§r '+Math.round(gPct)+'% av v√§gen till m√•let!';
    else if(s.total>0)status='Du har '+fmt(s.total)+' kr totalt';
    document.getElementById('greeting').textContent=g+'! '+status;
    const td=s.chores.reduce((a,c)=>a+c.done,0);
    const tn=s.chores.reduce((a,c)=>a+c.total,0);
    document.getElementById('chores-greeting').textContent=tn===0?'G√∂r klart dina sysslor f√∂r att f√• din peng!':td===tn?'üéâ Alla sysslor klara! Du har f√∂rtj√§nat din peng!':td+' av '+tn+' sysslor klara ‚Äì forts√§tt s√•!';
  }
  function renderChores(){
    const td=s.chores.reduce((a,c)=>a+c.done,0);
    const tn=s.chores.reduce((a,c)=>a+c.total,0);
    const pct=tn>0?Math.min(100,(td/tn)*100):0;
    const allDone=tn>0&&td===tn;
    const earned=tn>0?Math.round((td/tn)*s.pengAmount):0;
    const el=document.getElementById('peng-earned');
    if(tn>0&&earned>0&&earned<s.pengAmount){el.style.display='block';el.textContent='Tj√§nat hittills: '+fmt(earned)+' kr';}else{el.style.display='none';}
    document.getElementById('peng-amount').textContent=fmt(s.pengAmount);
    document.getElementById('peng-progress-fill').style.width=pct+'%';
    document.getElementById('peng-progress-pct').textContent=Math.round(pct)+'%';
    document.getElementById('peng-progress-left').textContent=td+' av '+tn+' sysslor klara';
    document.getElementById('peng-sub').textContent=s.pengAmount===0?'S√§tt ett belopp och l√§gg till sysslor!':allDone?'üéâ Du har f√∂rtj√§nat '+fmt(s.pengAmount)+' kr!':fmt(s.pengAmount)+' kr n√§r allt √§r klart';
    document.getElementById('btn-request-peng').style.display=allDone&&s.pengAmount>0?'block':'none';
    const list=document.getElementById('chore-list');
    if(!s.chores.length){list.innerHTML='<div class="empty-state"><span class="empty-emoji">üßπ</span>Inga sysslor √§nnu.<br>Tryck p√• "Hantera sysslor" nedan!</div>';return;}
    const perChore=tn>0?s.pengAmount/tn:0;
    list.innerHTML=s.chores.map((c,i)=>{
      const cp=c.total>0?Math.min(100,(c.done/c.total)*100):0;
      const ad=c.done>=c.total;
      const worth=Math.round(perChore*c.total);
      return '<div class="chore-card'+(ad?' done':'')+'"><div class="chore-info"><div class="chore-name">'+c.name+'</div><div class="chore-progress-text">'+c.done+' / '+c.total+' g√•nger</div>'+(worth>0?'<div class="chore-earned-text">V√§rd ~'+fmt(worth)+' kr</div>':'')+'<div class="chore-mini-track"><div class="chore-mini-fill" style="width:'+cp+'%"></div></div></div><button class="chore-btn '+(ad?'all-done':'not-done')+'" onclick="doChore('+i+')">'+(ad?'‚úÖ':'‚úîÔ∏è')+'</button></div>';
    }).join('');
  }
  function doChore(i){
    if(s.chores[i].done>=s.chores[i].total){s.chores[i].done=Math.max(0,s.chores[i].done-1);showToast('√Öngrade ett steg ‚Ü©Ô∏è');}
    else{s.chores[i].done++;const c=s.chores[i];if(c.done===c.total){showToast('üéâ '+c.name+' klar!');if(s.chores.every(ch=>ch.done>=ch.total))setTimeout(()=>launchConfetti(),300);}else{showToast('‚úîÔ∏è '+c.done+'/'+c.total+' ‚Äì '+c.name);}}
    persist();render();
  }
  function requestPeng(){const msg='Hej! üéâ Jag har gjort alla mina sysslor den h√§r perioden och vill beg√§ra min peng p√• '+fmt(s.pengAmount)+' kr. Tack! üíú';if(navigator.share){navigator.share({title:'Beg√§r min peng üí∞',text:msg});}else{navigator.clipboard.writeText(msg).then(()=>showToast('Meddelande kopierat! üìã'));}}
  function confirmResetChores(){if(!s.chores.length){showToast('Inga sysslor att √•terst√§lla!');return;}if(confirm('√Öterst√§lla alla sysslor till 0? G√∂r detta i b√∂rjan av en ny vecka/m√•nad.')){s.chores=s.chores.map(c=>({...c,done:0}));persist();render();showToast('Sysslor √•terst√§llda! üîÑ');}}
  function openManageSheet(){document.getElementById('peng-target-input').value=s.pengAmount||'';document.getElementById('new-chore-name').value='';document.getElementById('new-chore-count').value='';renderManageList();openSheet2('manage-sheet');}
  function renderManageList(){const list=document.getElementById('manage-chore-list');if(!s.chores.length){list.innerHTML='<div style="color:var(--text-muted);font-size:13px;font-weight:600;text-align:center;padding:10px;">Inga sysslor √§nnu</div>';return;}list.innerHTML=s.chores.map((c,i)=>'<div class="manage-chore-item"><span>'+c.name+'</span><small>'+c.total+' ggr</small><button class="btn-remove-chore" onclick="removeChore('+i+')">‚úï</button></div>').join('');}
  function addChore(){const name=document.getElementById('new-chore-name').value.trim();const count=parseInt(document.getElementById('new-chore-count').value)||1;if(!name){showToast('Ange ett namn! üôè');return;}s.chores.push({id:Date.now(),name,total:count,done:0});document.getElementById('new-chore-name').value='';document.getElementById('new-chore-count').value='';renderManageList();showToast('Syssla tillagd! ‚ú®');}
  function removeChore(i){s.chores.splice(i,1);renderManageList();}
  function saveManage(){const val=parseFloat(document.getElementById('peng-target-input').value);if(val>0)s.pengAmount=val;persist();render();closeAllSheets();showToast('Sparat! üéâ');}
  const iconMap={in:{emoji:'üíµ',cls:'hi-green',amtCls:'ha-green',sign:'+'},earmark:{emoji:'üíé',cls:'hi-purple',amtCls:'ha-purple',sign:'‚Üí'},spend:{emoji:'üõí',cls:'hi-coral',amtCls:'ha-coral',sign:'‚àí'},unearn:{emoji:'‚Ü©Ô∏è',cls:'hi-teal',amtCls:'ha-teal',sign:'‚Üê'},goal:{emoji:'üéØ',cls:'hi-purple',amtCls:'ha-purple',sign:''},adjust:{emoji:'‚öñÔ∏è',cls:'hi-orange',amtCls:'ha-orange',sign:''}};
  function addHistory(type,desc,amount){const now=new Date();s.history.push({id:Date.now()+Math.random(),type,desc,amount,date:now.toLocaleDateString('sv-SE',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'})});if(s.history.length>150)s.history.shift();}
  function renderHistory(){const list=document.getElementById('history-list');if(!s.history.length){list.innerHTML='<div class="empty-state"><span class="empty-emoji">üå±</span>Inga transaktioner √§n.<br>Tryck p√• "S√§tt in pengar" f√∂r att b√∂rja!</div>';return;}list.innerHTML=s.history.slice().reverse().map((item,ri)=>{const realIdx=s.history.length-1-ri;const m=iconMap[item.type]||iconMap['in'];const amt=item.type==='adjust'?(item.amount>=0?'+':'')+fmt(item.amount)+' kr':m.sign+fmt(Math.abs(item.amount))+' kr';return '<div class="history-item" onclick="openEditSheet('+realIdx+')"><div class="history-icon '+m.cls+'">'+m.emoji+'</div><div class="history-text"><div class="history-desc">'+item.desc+'</div><div class="history-date">'+item.date+'</div></div>'+(item.amount!==undefined?'<div class="history-amount '+m.amtCls+'">'+amt+'</div>':'')+'<span class="edit-hint">redigera</span></div>';}).join('');}
  const configs={in:{title:'üíµ S√§tt in pengar',desc:'Hur mycket pengar s√§tter du in? L√§ggs till totalt saldo.',btnCls:'btn-green',btnTxt:'S√§tt in üíµ',ph:'t.ex. Veckopeng, present, jobba‚Ä¶'},earmark:{title:'üíé Flytta till sparande',desc:'Hur mycket vill du flytta till sparandet?',btnCls:'btn-purple',btnTxt:'Spara üíé',ph:'Anteckning (valfritt)'},spend:{title:'üõí Jag handlade',desc:'Hur mycket handlade du f√∂r? Dras fr√•n fickpengar.',btnCls:'btn-coral',btnTxt:'Dra av üõí',ph:'Vad k√∂pte du?'},unearn:{title:'‚Ü©Ô∏è Flytta fr√•n sparande',desc:'Hur mycket vill du flytta tillbaka till fickpengar?',btnCls:'btn-teal',btnTxt:'Flytta tillbaka',ph:'Varf√∂r?'},adjust:{title:'‚öñÔ∏è Justera saldo',desc:'V√§lj riktning och vilket saldo som ska p√•verkas.',btnCls:'btn-orange',btnTxt:'Justera ‚öñÔ∏è',ph:'t.ex. Missade k√∂p, gl√∂mde s√§tta in‚Ä¶'}};
  function openSheet(action){currentAction=action;const c=configs[action];document.getElementById('sheet-title').textContent=c.title;document.getElementById('sheet-desc').textContent=c.desc;document.getElementById('sheet-btn').className='btn-confirm '+c.btnCls;document.getElementById('sheet-btn').textContent=c.btnTxt;document.getElementById('sheet-note').placeholder=c.ph;document.getElementById('sheet-amount').value='';document.getElementById('sheet-note').value='';const isAdj=action==='adjust';document.getElementById('adjust-toggle').style.display=isAdj?'flex':'none';document.getElementById('affect-toggle').style.display=isAdj?'flex':'none';if(isAdj){setDir(1);setAffect('total');}openSheet2('main-sheet');setTimeout(()=>document.getElementById('sheet-amount').focus(),300);}
  function openSheet2(id){closeAllSheets();document.getElementById(id).classList.add('visible');document.getElementById('overlay').classList.add('visible');}
  function openGoalSheet(){document.getElementById('goal-name-input').value=s.goalName;document.getElementById('goal-target-input').value=s.goalAmount||'';openSheet2('goal-sheet');setTimeout(()=>document.getElementById('goal-name-input').focus(),300);}
  function openEditSheet(idx){editIdx=idx;const item=s.history[idx];const m=iconMap[item.type]||iconMap['in'];document.getElementById('edit-title').textContent=m.emoji+' Redigera transaktion';document.getElementById('edit-amount').value=Math.abs(item.amount)||'';document.getElementById('edit-note').value=item.desc||'';openSheet2('edit-sheet');setTimeout(()=>document.getElementById('edit-amount').focus(),300);}
  function closeAllSheets(){['main-sheet','edit-sheet','goal-sheet','manage-sheet'].forEach(id=>document.getElementById(id).classList.remove('visible'));document.getElementById('overlay').classList.remove('visible');}
  function setDir(d){adjustDir=d;document.getElementById('toggle-plus').className='toggle-btn'+(d===1?' active-plus':'');document.getElementById('toggle-minus').className='toggle-btn'+(d===-1?' active-minus':'');}
  function setAffect(a){adjustAffect=a;['total','earmark','free'].forEach(k=>document.getElementById('aff-'+k).classList.toggle('active',k===a));}
  function takeSnapshot(){snapshot=JSON.parse(JSON.stringify(s));}
  function confirmAction(){
    const val=parseFloat(document.getElementById('sheet-amount').value);
    const note=document.getElementById('sheet-note').value.trim();
    if(!val||val<=0){showToast('Ange ett belopp! üôè');return;}
    takeSnapshot();
    if(currentAction==='in'){s.total+=val;addHistory('in',note||'Pengar insatta',val);showUndo('+'+fmt(val)+' kr insatta');}
    else if(currentAction==='earmark'){if(val>free()){showToast('Inte tillr√§ckligt i fickpengar! üò¨');return;}s.earmarked+=val;addHistory('earmark',note||'Flyttat till sparande',val);showUndo(fmt(val)+' kr sparade');if(s.goalAmount>0&&s.earmarked>=s.goalAmount)setTimeout(()=>launchConfetti(),300);}
    else if(currentAction==='spend'){if(val>free()){showToast('Inte tillr√§ckligt i fickpengar! üò¨');return;}s.total-=val;addHistory('spend',note||'Handlade',val);showUndo('‚àí'+fmt(val)+' kr draget');}
    else if(currentAction==='unearn'){if(val>s.earmarked){showToast('Inte tillr√§ckligt i sparandet! üò¨');return;}s.earmarked-=val;addHistory('unearn',note||'Flyttat fr√•n sparande',val);showUndo(fmt(val)+' kr tillbaka som fickpengar');}
    else if(currentAction==='adjust'){const signed=adjustDir*val;const desc=note||(adjustDir>0?'Justering +':'Justering ‚àí')+fmt(val)+' kr';if(adjustAffect==='total'){s.total=Math.max(0,s.total+signed);addHistory('adjust',desc+' (totalt)',signed);}else if(adjustAffect==='earmark'){s.earmarked=Math.max(0,s.earmarked+signed);s.total=Math.max(s.earmarked,s.total+signed);addHistory('adjust',desc+' (sparande)',signed);}else{s.total=Math.max(s.earmarked,s.total+signed);addHistory('adjust',desc+' (fickpengar)',signed);}showUndo('Saldo justerat');}
    persist();render();closeAllSheets();
  }
  function saveEdit(){if(editIdx<0)return;const val=parseFloat(document.getElementById('edit-amount').value);const note=document.getElementById('edit-note').value.trim();if(!val||val<=0){showToast('Ange ett belopp! üôè');return;}takeSnapshot();s.history[editIdx].amount=val;if(note)s.history[editIdx].desc=note;persist();render();closeAllSheets();showToast('Historik uppdaterad ‚úÖ');}
  function deleteEntry(){if(editIdx<0)return;takeSnapshot();s.history.splice(editIdx,1);persist();render();closeAllSheets();showToast('Transaktion borttagen üóë');}
  function saveGoal(){const name=document.getElementById('goal-name-input').value.trim();const val=parseFloat(document.getElementById('goal-target-input').value);if(!val||val<=0){showToast('Ange ett m√•lbelopp! üéØ');return;}s.goalName=name||'Mitt m√•l';s.goalAmount=val;addHistory('goal','Nytt m√•l: '+s.goalName,val);persist();render();closeAllSheets();showToast('Sparm√•l sparat! üéØ');}
  function showUndo(msg){document.getElementById('undo-msg').textContent=msg;const bar=document.getElementById('undo-bar');bar.classList.add('visible');clearTimeout(undoTimer);undoTimer=setTimeout(()=>{bar.classList.remove('visible');snapshot=null;},5000);}
  function undoLast(){if(!snapshot)return;s=snapshot;snapshot=null;persist();render();document.getElementById('undo-bar').classList.remove('visible');showToast('√Öngrat! ‚Ü©Ô∏è');}
  function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2600);}
  function launchConfetti(){const canvas=document.getElementById('confetti-canvas');const ctx=canvas.getContext('2d');canvas.width=window.innerWidth;canvas.height=window.innerHeight;const pieces=[];const colors=['#7C5CBF','#E91E8C','#F5A623','#27AE60','#1ABC9C','#FF6B6B','#FFD700'];for(let i=0;i<120;i++){pieces.push({x:Math.random()*canvas.width,y:-10-Math.random()*100,w:6+Math.random()*8,h:8+Math.random()*10,r:Math.random()*Math.PI*2,vx:(Math.random()-0.5)*4,vy:2+Math.random()*3,vr:(Math.random()-0.5)*0.2,color:colors[Math.floor(Math.random()*colors.length)],alpha:1});}let frame=0;function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);pieces.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.r+=p.vr;p.alpha=Math.max(0,1-frame/90);ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.r);ctx.globalAlpha=p.alpha;ctx.fillStyle=p.color;ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);ctx.restore();});frame++;if(frame<100)requestAnimationFrame(draw);else ctx.clearRect(0,0,canvas.width,canvas.height);}draw();}
  document.getElementById('sheet-amount').addEventListener('keydown',e=>{if(e.key==='Enter')confirmAction();});
  document.getElementById('edit-amount').addEventListener('keydown',e=>{if(e.key==='Enter')saveEdit();});
  document.getElementById('goal-target-input').addEventListener('keydown',e=>{if(e.key==='Enter')saveGoal();});
  document.getElementById('new-chore-name').addEventListener('keydown',e=>{if(e.key==='Enter')addChore();});
  render();
</script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js').catch(err => {
        console.log('SW registration failed', err);
      });
    });
  }
</script>
</body>
</html>
